import{I as F,N as e,L as D,O as j,ab as v,ao as k,U as g,ac as f,K as G,J as $,aa as V,ae as L,V as Z,S as P}from"./index-YngUMXNg.js";import{u as B}from"./index.esm-D6X6kllX.js";import{F as q,a as J,b as H,c as K,d as W,e as Y}from"./form-BaVjm44W.js";import{I as z}from"./input-jXGfHc8g.js";import{h as X}from"./order-DN46F7wb.js";import{B as A}from"./barcode-D45Ybdjw.js";import{C as ee,b as se,c as te,a as ae}from"./card-CqYw-V1t.js";import{P as re}from"./pencil-B8YbJYHy.js";import{S as ie}from"./send-DatqWQn0.js";import{C as ne}from"./check-check-DRbDsEqF.js";import{C as le}from"./chevron-down-DOs2cYKc.js";import{f as oe}from"./format-BBYAYFtJ.js";import"./label-CWpU4h0C.js";import"./apiEndpoints-aSQtSIWE.js";import"./handleApiError-B5XCkBcY.js";import"./startOfDay-Be0wd0F5.js";const de=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],ce=F("keyboard",de);const me=[["path",{d:"M12 3v6",key:"1holv5"}],["path",{d:"M16.76 3a2 2 0 0 1 1.8 1.1l2.23 4.479a2 2 0 0 1 .21.891V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9.472a2 2 0 0 1 .211-.894L5.45 4.1A2 2 0 0 1 7.24 3z",key:"187q7i"}],["path",{d:"M3.054 9.013h17.893",key:"grwhos"}]],xe=F("package-2",me),ue="/assets/sound-bip-hQk9Q5dh.mp3";function Q({data:o,showHeader:p=!0}){return o?e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-200",children:[p&&e.jsx("div",{className:"bg-linear-to-r from-primary to-primary/85 px-4 py-3",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-white font-semibold text-lg leading-tight",children:o.PROD_DESCR||"Produto"})})})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-3 mb-3 border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-primary/20 rounded-lg p-2 flex items-center justify-center",children:e.jsx(xe,{size:20,className:"text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Código"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:o.PROD_CODIGO})]})]})}),o.CODIGO_BARRAS&&e.jsx("div",{className:"bg-primary/10 rounded-lg p-3 mb-3 border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-primary/20 rounded-lg p-2 flex items-center justify-center",children:e.jsx(A,{size:20,className:"text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Cód. Barras"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:o.CODIGO_BARRAS})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Lote"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:o.LOTE})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Série"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:o.SERIE})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Qtd Lido"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:o.QTDE_LIDO})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Qtd Utilizada"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:o.QTDE_UTILIZADA})]})]})]})]}):null}function fe({data:o,sendOrder:p,updateProducts:S,backScreen:h}){const[E,R]=D.useState(!1),{register:O,handleSubmit:C,setValue:s}=B();async function c({quantityProduct:a}){if(typeof E=="number"){const x=await g();o[E].QTDE_LIDO=a,x.CONFERENCE.PRODUCTS=o,await f(x),S(o),R(!1)}}async function I(a,x){const N=await g(),y=N.ORDERS.NEW||[],_=y?.find(b=>b.CODIGO_BARRAS===a.CODIGO_BARRAS);if(a.QTDE_ORDER=a.QTDE-a.QTDE_LIDO,!_)y.push(a);else{const b=y?.findIndex(T=>T.CODIGO_BARRAS===a.CODIGO_BARRAS);b!==-1&&(y[b]=a)}N.ORDERS.NEW=y,await f(N),p(x)}async function m(){const a=await g();a.CONFERENCE.open=!1,await f(a)}return e.jsxs("section",{className:"flex h-full w-full flex-col justify-between gap-4",children:[e.jsx("div",{className:"flex h-full w-full flex-col gap-4 overflow-y-auto pb-20",children:o?.filter(a=>a.QTDE-a.QTDE_LIDO>0).map((a,x)=>e.jsxs(ee,{className:"shadow-sm p-0 gap-0",children:[e.jsx(se,{className:"bg-primary rounded-t-xl px-3 py-2 flex items-center",children:e.jsx(te,{className:"text-white text-base flex items-center",children:a.PROD_DESCR})}),e.jsxs(ae,{className:"space-y-2 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Lote:"})," ",a.LOTE]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Série:"})," ",a.SERIE]})]}),e.jsx("span",{className:`font-semibold text-sm ${a.QTDE-a.QTDE_LIDO===a.QTDE?"text-red-600":"text-green-600"}`,children:a.QTDE-a.QTDE_LIDO===a.QTDE?"Não conferido":"Conferido"}),e.jsx("div",{className:"border-b border-primary/20 py-2",children:e.jsx("span",{className:"text-purple-700 font-semibold text-sm",children:"Quantidades"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"Lido/Utilizado:"})," ",a.QTDE_LIDO]}),typeof E=="number"&&E===x&&e.jsxs("form",{className:"flex items-center gap-2",onSubmit:C(c),children:[e.jsx(z,{type:"number",max:a.QTDE,className:"h-8 w-20",...O("quantityProduct"),min:0}),e.jsx(j,{type:"submit",size:"icon-sm",children:e.jsx(v,{className:"size-4"})})]})]}),e.jsxs("span",{className:"text-gray-700 text-sm",children:[e.jsx("strong",{children:"Consignado:"})," ",a.QTDE]})]}),e.jsxs("p",{className:"text-gray-700 text-sm",children:[e.jsx("strong",{children:"Diferença:"})," ",a.QTDE-a.QTDE_LIDO]})]}),a.STATUS!==2&&a.QTDE-a.QTDE_LIDO>0&&e.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[e.jsxs(j,{onClick:()=>{R(x),s("quantityProduct",a.QTDE_LIDO)},variant:"secondary",className:"w-full bg-tertiary text-white hover:bg-tertiary/95",children:[e.jsx(re,{className:"size-4"}),"Editar"]}),e.jsxs(j,{onClick:()=>I(a,x),className:"w-full",children:[e.jsx(ie,{className:"size-4"}),"Enviar pedido"]})]}),a.STATUS===2&&e.jsxs("div",{className:"flex items-center justify-center gap-2 bg-primary/10 rounded-lg p-3",children:[e.jsx(v,{className:"size-5 text-primary"}),e.jsx("span",{className:"font-semibold text-primary",children:"Pedido realizado!"})]})]})]},`${a.ESIN_ID}_${a.PROD_ID}_${a.LOTE}_${a.SERIE}`))}),e.jsxs("footer",{className:"fixed bottom-0 left-0 right-0 bg-white/50 backdrop-blur-sm border-t border-zinc-400 p-3 shrink-0 flex items-center justify-between gap-1",children:[e.jsxs("button",{onClick:h,className:"drop-shadow-xl place-self-end drop-shadow-primary/40 w-1/3 py-3 px-6 rounded-2xl bg-white text-primary border-primary active:scale-[0.98] transition-transform flex items-center justify-center gap-2 font-semibold",children:[e.jsx(k,{className:"size-5"}),"Voltar"]}),e.jsxs("button",{onClick:m,className:"drop-shadow-xl place-self-end drop-shadow-primary/40 w-2/3 py-3 px-6 rounded-2xl bg-primary/90 text-white border-primary active:scale-[0.98] transition-transform flex items-center justify-center gap-2 font-semibold",children:[e.jsx(ne,{className:"size-5"}),"Encerrar conferência"]})]})]})}function Te(){const[o,p]=D.useState(0),[S,h]=D.useState(!1),[E,R]=D.useState([]),[O,C]=D.useState([]),[s,c]=D.useState({products:[],lastAddPos:!1,finish:!1,openConference:!0,message:"Testando mensagem de avisos"}),{showLoading:I,hideLoading:m}=G(),a=$(),x=B(),{setFocus:N,handleSubmit:y}=x;async function _({code:t}){try{if(S)return;h(!0),I();const l=await g(),r=E?.filter(n=>t.includes(n.CODIGO_BARRAS)&&n.QTDE-n.QTDE_UTILIZADA>0);let i=s?.products?.find(n=>t.includes(n.CODIGO_BARRAS));if(r&&r.length>1){let n=r?.filter(w=>`${t}`.includes(w.LOTE.substring(4)));if(n&&n.length===1)i=n[0];else if(n=r?.find(w=>`${t}`.includes(oe(new Date(w.DATA_VALIDADE),"yy/MM/dd").replaceAll("/",""))),n)i=n;else{m(),C(r);return}}else r&&r.length===1&&(i=r[0]);let d=s?.lastAddPos;if(i&&i.STATUS===2){s.message="Já existe um pedido com esse produto",m(),c(s);return}if(!i)i=E?.find(n=>t.includes(n.CODIGO_BARRAS)),i&&(i?.LOTE&&i?.SERIE&&(i.QTDE_LIDO=i.QTDE_UTILIZADA+1),s.products.push(i),d=s?.products.length-1);else{const n=s?.products?.findIndex(w=>w.ESIN_ID===i.ESIN_ID);n!==-1?(s?.products[n]?.LOTE&&s?.products[n]?.SERIE&&(s.products[n].QTDE_LIDO=(Number(s?.products[n].QTDE_LIDO)||0)+1),d=n):(i.QTDE_LIDO=i.QTDE_UTILIZADA+1,s.products.push(i))}if(!i){s.message="Código de barras inválido",c(s),C(null),h(!1),m();return}await f(l),l.CONFERENCE.PRODUCTS=s.products,await f(l),s.lastAddPos=d,s.message=`${i.PROD_DESCR} - CONFERIDO COM SUCESSO`,c(s);const u=document.getElementById("audio");u&&u.play()}catch{}finally{setTimeout(()=>{N("code"),h(!1),m()},1e3),setTimeout(()=>{s.message=null,c(s)},5e3)}}async function b(t){if(S)return;h(!0),I();const l=await g();if(!t){s.message="Produto não encontrado",c(s),h(!1),m();return}let r=s?.products?.find(u=>u.ESIN_ID===t.ESIN_ID),i=s?.lastAddPos;if(r&&r.STATUS===2){s.message="Já existe um pedido com esse produto`",c(s),h(!1),m();return}if(!r)r=t,r?.LOTE&&r?.SERIE&&(r.QTDE_LIDO=r.QTDE_UTILIZADA+1,r.MOD=!0),s?.products.push(r),i=s?.products.length-1;else{const u=s?.products?.findIndex(n=>n.ESIN_ID===t.ESIN_ID);r?.LOTE&&r?.SERIE&&(r.QTDE_LIDO=(r.QTDE_LIDO||0)+1),u!==-1&&(r.MOD=!0,s.products[u]=r,i=u)}await f(l),l.CONFERENCE.PRODUCTS=s?.products,await f(l),s.lastAddPos=i,s.message=`${r.PROD_DESCR} - CONFERIDO COM SUCESSO`,c(s);const d=document.getElementById("audio");d&&d.play(),setTimeout(()=>{C(null),N("code"),h(!1),m()},1e3),setTimeout(()=>{s.message=null,c(s)},5e3)}async function T(){try{const t=await g(),l=[];E.forEach(r=>{s?.products?.find(d=>d.ESIN_ID===r.ESIN_ID)||(r.QTDE_LIDO=r.QTDE_UTILIZADA,l.push(r))}),s.products=[...s?.products||[],...l],t.CONFERENCE.PRODUCTS=s?.products,await f(t),s.finish=!0,p(2),c(s),t.CONFERENCE.finishConference=!0,await f(t)}catch(t){console.error(t)}}async function M(t){const l=await g(),r=s?.products[t],i=Z();r.QTDE_ORDER=r.QTDE-r.QTDE_LIDO;let d=l?.CLIENTES?.find(n=>n.SEQ_PADRAO===l.cliAtendimento);if(!d&&(d=l.CLI_IN_PROGRESS,!d)){P("Não foi possível encontrar o cliente atual"),m();return}const u=[{name:typeof d!="number"?d.CLI_NOME_FANTASIA:"",emp:r.ESIN_EMP_ID||i.empresaId,id:r.CLI_ID||typeof d!="number"?d.CLI_ID:d,products:[r]}];a("/Admin/OrderDirect/NewOrder",{state:{companys:JSON.stringify(u),statusVenda:3,order:JSON.stringify(r),view:!1,productsFilter:[],productsOrigins:[],conference:!0}})}async function U(){try{I();const t=await g();let l=t?.CONFERENCE?.INVENTORY;if((!l||l.length===0)&&(l=await X(t.CLI_IN_PROGRESS)),!l){P("Não foi possível buscar os dados, verifique sua conexão com a internet"),m(),a("/Admin");return}l=l?.filter(r=>r.QTDE-r.QTDE_UTILIZADA>0&&r.CODIGO_BARRAS!==null),p(t.CONFERENCE&&t.CONFERENCE.finishConference?2:0),c({products:t.CONFERENCE?t.CONFERENCE.PRODUCTS:[],lastAddPos:t.CONFERENCE?t.CONFERENCE.lastAddPos:!1,finish:t.CONFERENCE?t.CONFERENCE.finishConference:!1,openConference:t.CONFERENCE?t.CONFERENCE.open:!0}),R(l)}catch{}finally{m()}}return D.useEffect(()=>{U()},[]),e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Conferência",backPath:"/Admin",showBackButton:!0}),e.jsxs("div",{className:"flex w-full flex-col gap-4 p-4 lg:pt-18",children:[o!==2&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{className:"gap-2 bg-green-700 hover:bg-green-700/90 text-white min-w-32",onClick:T,children:["Finalizar",e.jsx(L,{size:16})]})}),o===0&&e.jsxs(e.Fragment,{children:[s?.products&&s?.products.length>0&&e.jsxs("div",{className:"w-full flex flex-col rounded-md gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full rounded-lg shadow-sm shadow-primary bg-primary px-4 py-2",children:[e.jsxs("span",{className:"flex items-center justify-center gap-2 bg-white/15 px-4 py-2 w-max rounded-full text-white text-sm",children:[e.jsx(A,{size:16}),"Último código de barras"]}),e.jsx("span",{className:"text-xl font-bold text-white",children:typeof s?.lastAddPos=="number"?s?.products[s?.lastAddPos]?.CODIGO_BARRAS:s?.products.at(-1)?.CODIGO_BARRAS})]}),e.jsx(Q,{data:typeof s?.lastAddPos=="number"?s?.products[s?.lastAddPos]:s?.products.at(-1)})]}),e.jsxs(j,{onClick:()=>{p(1),N("code")},type:"button",variant:"secondary",className:"w-full bg-indigo-800 py-4 hover:bg-indigo-800/90 text-white gap-2",children:[e.jsx(ce,{size:20}),"Digitar código de barras"]}),s?.products&&s?.products.length>0&&e.jsxs("div",{className:"w-full border-t border-border pt-2",children:[e.jsxs("span",{className:"text-xl font-semibold text-zinc-900",children:[s?.products.length===1&&`${s?.products.length} produto escaneado`,s?.products.length>1&&`${s?.products.length} produtos escaneados`]}),e.jsx("div",{className:"h-full overflow-y-auto",children:s?.products.map(t=>e.jsx("div",{className:"mt-1",children:e.jsxs("details",{className:"group rounded-md border border-border",children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between rounded-t-md bg-primary p-4 text-left text-xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:t.MOD?`${t.LOTE} / ${t.SERIE}`:`${t.PROD_CODIGO}`}),e.jsx("span",{className:"font-normal",children:`- ${t.PROD_DESCR}`})]}),e.jsx(le,{className:"transition-transform group-open:rotate-180"})]}),e.jsx(Q,{data:t,showHeader:!1})]})},`${t.ESIN_ID}_${t.PROD_ID}`))})]})]}),o===1&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{onClick:()=>p(0),type:"button",className:"w-full gap-2",children:[e.jsx(k,{size:20}),"Voltar"]}),O&&O.length>0&&e.jsxs("div",{className:"w-full rounded-md border border-primary",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full rounded-lg shadow-sm shadow-primary bg-primary px-4 py-2",children:[e.jsxs("span",{className:"flex items-center justify-center gap-2 bg-white/15 px-4 py-2 w-max rounded-full text-white text-sm",children:[e.jsx(A,{size:16}),"Último código de barras"]}),e.jsx("span",{className:"text-xl font-bold text-white",children:typeof s?.lastAddPos=="number"?s?.products[s?.lastAddPos]?.CODIGO_BARRAS:s?.products.at(-1)?.CODIGO_BARRAS})]}),e.jsxs("div",{className:"p-1",children:[e.jsx("span",{className:"text-lg font-bold text-black",children:"Selecione uma opção"}),O.map(t=>e.jsxs("button",{className:"relative mt-4 flex w-full flex-col overflow-hidden rounded-xl border border-primary/20 bg-linear-to-br from-white to-primary/5 p-4 shadow-md transition-all duration-300",onClick:()=>b(t),children:[e.jsx("div",{className:"absolute left-0 top-0 h-full w-1 bg-linear-to-b from-primary via-primary/80 to-primary/60"}),e.jsx("div",{className:"mb-3 flex items-center gap-2",children:e.jsx("span",{className:"rounded-full bg-linear-to-r from-primary to-primary/80 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-white shadow-sm",children:"Lote / Série"})}),e.jsxs("div",{className:"flex flex-col gap-1 pl-2",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900 transition-colors",children:[t.LOTE," / ",t.SERIE]}),e.jsx("span",{className:"text-sm leading-tight text-gray-600 transition-colors",children:t.PROD_DESCR})]}),e.jsx("div",{className:"absolute bottom-0 right-0 h-8 w-8 translate-x-4 translate-y-4 rounded-full bg-primary/10 transition-transform duration-300"})]},t.PROD_CODIGO))]})]}),e.jsx(q,{...x,children:e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:y(_),children:[e.jsx(J,{control:x.control,name:"code",render:({field:t})=>e.jsxs(H,{children:[e.jsx(K,{children:"Digite o código de barras do produto"}),e.jsx(W,{children:e.jsx(z,{...t,autoFocus:!0})}),e.jsx(Y,{})]})}),e.jsxs(j,{type:"submit",className:"w-full gap-2",children:[e.jsx(L,{size:20}),"Confirmar"]})]})}),s?.message&&e.jsx("div",{className:"mt-1 flex w-full items-center justify-center rounded-lg bg-primary/5 border border-dotted border-primary p-4 shadow-sm shadow-primary",children:e.jsx("span",{className:"text-center text-lg font-medium text-primary",children:s?.message})})]}),o===2&&s?.products&&e.jsx(fe,{data:s?.products,sendOrder:t=>{M(t)},updateProducts:t=>{s.products=t,c(s)},backScreen:async()=>{const t=await g();t.CONFERENCE.finishConference=!1,s.finish=!1,p(1),c(s),await f(t)}})]}),e.jsx("audio",{id:"audio",src:ue})]})}export{Te as default};
