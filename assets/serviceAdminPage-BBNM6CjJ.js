import{I as w,L as c,J as X,K as Y,N as e,a1 as Ne,O as d,ae as q,R as T,S as x,am as ye,a4 as ve,U as R,aa as we,P as De,X as be,V as Se,aq as E,ar as P}from"./index-CYXlB6di.js";import{u as Z}from"./index.esm-g7wEG1vX.js";import{C as Ce}from"./calendar-CbLc9Ubs.js";import{C as u,a as f,b as S,c as C,d as K}from"./card-CyEq7GHL.js";import{D as W,a as ee,b as se,c as ae,e as te,d as oe}from"./dialog-LwW192j0.js";import{F as ne,a as le,b as ie,c as re,d as ce,e as de}from"./form-tFIv0F5k.js";import{I as xe}from"./input-B9CoZ-jW.js";import{P as ze,a as Me,b as ke}from"./popover-BaGBQ11z.js";import{C as Ae,k as Be,m as _e,n as Le,o as Ie}from"./homeServices-C-QDDkvr.js";import{B as Fe}from"./badge-CLCEEXGn.js";import{C as J}from"./clock-IyxNcF_P.js";import{T as Ee}from"./trash-2-CkKNHqj5.js";import{C as Pe}from"./calendar-t7hk2tVO.js";import{S as Te}from"./save-YfvLh6Z0.js";import{f as b}from"./format-BBYAYFtJ.js";import"./startOfDay-Be0wd0F5.js";import"./addDays-CyOWDzeI.js";import"./chevron-down-BrwHMvvE.js";import"./index-BqX2kfYm.js";import"./index-DekvUVLv.js";import"./index-j1y6my5Y.js";import"./label-DZv4CB4a.js";import"./apiEndpoints-aSQtSIWE.js";import"./currency-CxFzcO-j.js";import"./timesAndDates-BA0J74pm.js";import"./pt-BR-mIVN-mbg.js";import"./handleApiError-Mr_6qIMG.js";import"./useQuery-hx1aMKYH.js";const Oe=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Q=w("database",Oe);const Ue=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],He=w("download",Ue);const Ve=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],$e=w("hard-drive",Ve);const Ge=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],qe=w("list",Ge);const Re=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ke=w("upload",Re);function Je({data:N,date:z}){const[m,h]=c.useState(null),l=Z(),M=X(),{showLoading:k,hideLoading:j}=Y();function t(s){return{end:{label:"Dia finalizado",variant:"destructive",icon:J},sync:{label:"Sincronizado",variant:"default",icon:q},start:{label:"Dia iniciado",variant:"outline",icon:Ae}}[s]}async function A(s){try{const a=s.code,n=await T.post("v1/pwd/validate",{pwd:a}),{sucess:B}=n.data;if(B)return await i(),null;x("Não foi possivel realizar a autenticação, verifique se o código está correto")}catch{x("Não foi possivel realizar a autenticação")}}async function i(){try{k();const s=await Be(m._ID);if(s){const a=s.find(n=>n._id===m._id);if(a.DB){const n=await ye(a.DB);await ve(n),x("Os dados do app foram atualizados",1),M("/expired")}else x("Não foi possível atualizar os dados")}else x("Não foi possível atualizar os dados");h(null)}catch{x("Não foi possível atualizar os dados")}finally{j()}}return e.jsxs("div",{className:"w-full",children:[!N&&e.jsx(u,{children:e.jsx(f,{className:"py-8",children:e.jsxs("p",{className:"text-center font-medium text-zinc-500",children:["Não existem dados sincronizados no dia ",e.jsx("strong",{children:z})," até o momento"]})})}),N&&e.jsx("div",{className:"w-full space-y-2",children:N.map(s=>{const a=t(s.STATUS),n=a.icon;return e.jsx(u,{className:"overflow-hidden p-2",children:e.jsx(S,{className:"p-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(C,{className:"text-base",children:[s.DATA," - ",s.HORA]})]}),e.jsxs(Fe,{variant:a.variant,className:Ne("w-fit gap-1.5",a.variant==="outline"&&"bg-blue-700 text-white",a.variant==="destructive"&&"bg-green-700 text-white"),children:[e.jsx(n,{className:"h-3 w-3"}),a.label]})]}),e.jsx(d,{size:"sm",onClick:()=>h(s),className:"shrink-0",children:"Obter dados"})]})})},s._id)})}),e.jsx(W,{open:!!m,onOpenChange:()=>h(null),children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Obter dados do servidor"}),e.jsxs(te,{className:"text-base font-medium text-zinc-500",children:["Insira abaixo o código para obter os dados que estão no servidor, composto por 6 números. Um código só pode ser utilizado"," ",e.jsx("strong",{children:"UMA"})," vez."]})]}),e.jsx(ne,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(A),className:"flex flex-col gap-4",children:[e.jsx(le,{control:l.control,name:"code",render:({field:s})=>e.jsxs(ie,{children:[e.jsx(re,{children:"Código de autenticação"}),e.jsx(ce,{children:e.jsx(xe,{...s,type:"text",maxLength:6,autoComplete:"off",placeholder:"Digite o código"})}),e.jsx(de,{})]})}),e.jsxs(oe,{children:[e.jsx(d,{type:"button",onClick:()=>h(null),variant:"outline",children:"Cancelar"}),e.jsxs(d,{type:"submit",className:"gap-2",children:[e.jsx(q,{size:16}),"Confirmar"]})]})]})})]})})]})}function bs(){const[N,z]=c.useState(null),[m,h]=c.useState(!1),[l,M]=c.useState(null),[k,j]=c.useState(!1),[t,A]=c.useState(void 0),{showLoading:i,hideLoading:s}=Y(),a=X(),n=Z(),{handleSubmit:B}=n;async function O(o,r,p=!1){if(o&&!p){if(m){h(!1);return}else if(N!==-1){h(!0);return}i()}i();let y=null;r&&(y=b(r,"dd/MM/yyyy"));const v=await _e(y);s(),z(v),h(!0)}async function me(){i(),await Le(),s(),a("/")}async function ue(){i(),await Ie(),s()}async function he({code:o}){try{const r=await R(),p=Se();if(p){const y=p.empresaId,v=p.codigoUsuario;i();const D=(await T.post("v1/pwd/validate",{pwd:o})).data;!D||D.length<=0?D.sucess||x("Não foi possível comunicar com o servidor"):D.sucess?(await T.post(`v1/tradedashboard/route/reset/force/${y}/${v}`,{gaaId:r.GAA_ID})).data.sucess?(i("Limpando dados dias posteriores..."),await E("saib.user"),await E("currentCustomer"),await E("currentSearch"),i("Limpando dados pesquisas hoje..."),await P("scheduleDataDB"),i("Limpando imagens..."),await P("imageDB"),await P("errorsDB"),a("/expired")):x("Erro ao limpar dados no servidor!"):(j(!0),x("Não foi possivel realizar autenticação"))}}catch{x("Não foi possível comunicar com o servidor")}finally{j(!1),s()}}c.useEffect(()=>{(async function(){const r=await R();M(r)})()},[]),c.useEffect(()=>{t&&O(!0,t,!0)},[t]);const[_,pe]=c.useState(null);c.useEffect(()=>{navigator.storage&&navigator.storage.estimate&&navigator.storage.estimate().then(o=>{pe(o)})},[]);const L=(o,r=2)=>{if(!+o)return{value:"0",unit:"Bytes"};const p=1024,y=r<0?0:r,v=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],F=Math.floor(Math.log(o)/Math.log(p));return{value:parseFloat((o/Math.pow(p,F)).toFixed(y)).toString(),unit:v[F]}},g=_?.quota||0,I=_?.usage||0,U=g-I,H=_?.usageDetails?.indexedDB||0,V=L(U),$=L(I),G=L(H),fe=g>0?U/g*100:0,je=g>0?I/g*100:0,ge=g>0?H/g*100:0;return e.jsxs(e.Fragment,{children:[e.jsx(we,{title:"Dados locais",backPath:"/",showBackButton:!0}),e.jsxs("div",{className:"flex w-full flex-col gap-4 py-4 px-2 lg:pt-20",children:[l?e.jsxs(u,{className:"p-2 gap-2",children:[e.jsxs(S,{className:"p-0",children:[e.jsx(C,{children:"Informações do Promotor"}),e.jsxs(K,{className:"font-medium",children:["Data dos dados sincronizados:"," ",l?.GAA_DTA_AGENDA||"N/A"]})]}),e.jsxs(f,{className:"grid grid-cols-2 gap-1 p-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Cód. agend."}),e.jsx("span",{className:"text-lg font-semibold",children:l?.GAA_ID})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data Agend."}),e.jsx("span",{className:"text-lg font-semibold",children:l?.GAA_DTA_AGENDA})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nome Promotor"}),e.jsx("span",{className:"text-lg font-semibold",children:l?.USR_NOME})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Agendados"}),e.jsx("span",{className:"text-lg font-semibold",children:l?.QTDE_CLIENTES})]})]})]}):e.jsx(u,{children:e.jsx(f,{className:"flex items-center justify-center py-8",children:e.jsx("span",{className:"text-center text-lg font-semibold text-muted-foreground",children:"Não existem dados locais"})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(u,{children:e.jsxs(f,{className:"flex flex-col items-center justify-center gap-2 py-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:e.jsx($e,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-xs text-center text-muted-foreground",children:"Espaço Livre"}),e.jsx("span",{className:"text-xl font-bold",children:V.value}),e.jsx("span",{className:"text-xs text-muted-foreground",children:V.unit})]}),e.jsx("div",{className:"h-1 w-full rounded-full bg-green-200",children:e.jsx("div",{className:"h-1 rounded-full bg-green-500",style:{width:`${fe}%`}})})]})}),e.jsx(u,{children:e.jsxs(f,{className:"flex flex-col items-center justify-center gap-2 py-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-blue-100",children:e.jsx(Q,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"Usado"}),e.jsx("span",{className:"text-xl font-bold",children:$.value}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$.unit})]}),e.jsx("div",{className:"h-1 w-full rounded-full bg-blue-200",children:e.jsx("div",{className:"h-1 rounded-full bg-blue-500",style:{width:`${je}%`}})})]})}),e.jsx(u,{children:e.jsxs(f,{className:"flex flex-col items-center justify-center gap-2 py-6",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-orange-100",children:e.jsx(Q,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"IndexedDB"}),e.jsx("span",{className:"text-xl font-bold",children:G.value}),e.jsx("span",{className:"text-xs text-muted-foreground",children:G.unit})]}),e.jsx("div",{className:"h-1 w-full rounded-full bg-orange-200",children:e.jsx("div",{className:"h-1 rounded-full bg-orange-500",style:{width:`${ge}%`}})})]})})]}),e.jsxs(u,{className:"p-3 gap-1",children:[e.jsx(S,{className:"p-0",children:e.jsx(C,{children:"Ações"})}),e.jsxs(f,{className:"flex flex-wrap gap-2 p-0",children:[e.jsxs(d,{onClick:()=>j(!0),variant:"outline",className:"gap-2",children:[e.jsx(Ee,{size:16}),"Limpar dados"]}),e.jsxs(d,{onClick:me,variant:"outline",className:"gap-2",children:[e.jsx(He,{size:16}),"Download"]}),e.jsxs(d,{onClick:ue,variant:"outline",className:"gap-2",children:[e.jsx(Ke,{size:16}),"Upload"]}),e.jsxs(d,{onClick:()=>O(m,null),variant:"outline",className:"gap-2",children:[e.jsx(qe,{size:16}),!m&&"Visualizar dados",m&&"Minimizar dados"]})]})]}),e.jsxs(u,{className:"p-3 gap-1",children:[e.jsxs(S,{className:"p-0",children:[e.jsx(C,{children:"Histórico de Sincronização"}),e.jsxs(K,{className:"font-medium",children:["Data dos dados sincronizados:"," ",t?b(t,"dd/MM/yyyy"):"Hoje"]})]}),e.jsxs(f,{className:"flex flex-col gap-4 p-0",children:[e.jsxs(ze,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:De("w-full justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),t?b(t,"dd/MM/yyyy"):"Selecione uma data"]})}),e.jsx(ke,{className:"w-auto p-0",children:e.jsx(Ce,{mode:"single",selected:t,onSelect:A,initialFocus:!0})})]}),m&&e.jsx(Je,{data:N,date:b(t||new Date,"dd/MM/yyyy")})]})]})]}),e.jsx(W,{open:k,onOpenChange:j,children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Limpar dados locais"}),e.jsxs(te,{className:"font-medium text-base text-zinc-500",children:["Insira abaixo o código para a limpeza de dados locais, composto por 6 números. Um código só pode ser utilizado"," ",e.jsx("strong",{children:"UMA"})," vez. Para prosseguir realize a autenticação."]})]}),e.jsx(ne,{...n,children:e.jsxs("form",{onSubmit:B(he),className:"flex flex-col gap-4",children:[e.jsx(le,{control:n.control,name:"code",render:({field:o})=>e.jsxs(ie,{children:[e.jsx(re,{children:"Código de autenticação"}),e.jsx(ce,{children:e.jsx(xe,{...o,type:"text",maxLength:6,placeholder:"Digite o código"})}),e.jsx(de,{})]})}),e.jsxs(oe,{children:[e.jsxs(d,{type:"button",onClick:()=>j(!1),variant:"outline",children:[e.jsx(be,{size:16,className:"mr-2"}),"Fechar"]}),e.jsxs(d,{type:"submit",children:[e.jsx(Te,{size:16,className:"mr-2"}),"Salvar"]})]})]})})]})})]})}export{bs as default};
