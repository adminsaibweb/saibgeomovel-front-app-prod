import{I as Q,L as l,K as ne,N as e,O as C,P as pe,X as ue,V,S as u,R as ee,W as ae,Y as Me,Z as ge,_ as Ke,J as ye,a0 as De,a1 as Ge,a2 as je,a3 as le,a4 as Le}from"./index-YngUMXNg.js";import{C as be}from"./calendar-NjMd2Ge-.js";import{D as _e,a as Ie,b as Ae,c as he,d as xe}from"./dialog-BOt40gKF.js";import{I as re}from"./input-jXGfHc8g.js";import{L as W}from"./label-CWpU4h0C.js";import{P as Ce,a as ve,b as Oe}from"./popover-BjgOAWtL.js";import{g as Y,h as Fe,u as Te,l as we,a as Se,C as Ee,s as Re,e as ke}from"./homeServices-CpeKEX-f.js";import{C as J}from"./camera-CN1lv929.js";import{C as ze}from"./calendar-BYoEDV41.js";import{f as B}from"./format-BBYAYFtJ.js";import{d as oe,w as Ue,g as He,a as Pe,f as ce}from"./timesAndDates-DyUV-en1.js";import{h as Be}from"./handleApiError-B5XCkBcY.js";import{C as $e}from"./clock-DtKml6_n.js";import{T as de}from"./timer--7ll23NN.js";import{R as qe}from"./refresh-cw-jQzGVHoK.js";import{C as Je}from"./check-check-DRbDsEqF.js";import{S as We}from"./store-NJ4uit83.js";import"./startOfDay-Be0wd0F5.js";import"./addDays-CyOWDzeI.js";import"./chevron-down-DOs2cYKc.js";import"./index-DJgVxpi-.js";import"./index-BFQh2s5u.js";import"./index-uC_SKFd_.js";import"./apiEndpoints-aSQtSIWE.js";import"./currency-CxFzcO-j.js";import"./useQuery-PaZTN53n.js";import"./pt-BR-mIVN-mbg.js";const Ve=[["path",{d:"M15.6 2.7a10 10 0 1 0 5.7 5.7",key:"1e0p6d"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M13.4 10.6 19 5",key:"1kr7tw"}]],Qe=Q("circle-gauge",Ve);const Ze=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Xe=Q("copy",Ze);const Ye=[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]],fe=Q("lock-keyhole",Ye);const ea=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],aa=Q("play",ea);const ta=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],sa=Q("smartphone",ta);function na({open:s,onOpenChange:c,currentDrivenOdometro:r,HodometroD:T}){const[h,U]=l.useState(new Date),[M,I]=l.useState({img:r?.GKM_KM_INICIAL_FOTO||null,fileExtension:""}),[f,g]=l.useState({img:r?.GKM_KM_FINAL_FOTO||null,fileExtension:""}),[a,w]=l.useState(r||{GKM_USR_AGENDA_ID:null,GKM_DATA:null,GKM_KM_INICIAL:null,GKM_KM_INICIAL_DATA:null,GKM_KM_INICIAL_FOTO:null,GKM_KM_INICIAL_LATITUDE:null,GKM_KM_INICIAL_LONGITUDE:null,GKM_KM_FINAL:null,GKM_KM_FINAL_DATA:null,GKM_KM_FINAL_FOTO:null,GKM_KM_FINAL_LATITUDE:null,GKM_KM_FINAL_LONGITUDE:null,GAA_KM_INICIAL:null,GAA_KM_FINAL:null}),{showLoading:v,hideLoading:A,isLoading:O}=ne();async function S(i,n=1920,_=.7){return new Promise((G,x)=>{const p=new FileReader;p.readAsDataURL(i),p.onload=k=>{const o=new Image;o.src=k.target?.result,o.onload=()=>{const L=document.createElement("canvas");let F=o.width,E=o.height;F>n&&(E=E*n/F,F=n),L.width=F,L.height=E,L.getContext("2d")?.drawImage(o,0,0,F,E),L.toBlob(Z=>{Z?G(Z):x(new Error("Falha ao comprimir imagem"))},"image/jpeg",_)},o.onerror=x},p.onerror=x})}async function P(i){try{v();const n=i.target.files?.[0];if(n){const _=await S(n,1920,.7),G=n.name.substring(n.name.lastIndexOf("."),n.name.length),x=_.size<n.size?_:n;return{img:await Me(x),fileExtension:G}}}catch{u("Não foi possível salvar a imagem")}finally{A()}}async function t(){try{const i=V();if(i){v();const{latitude:n,longitude:_}=await Y();if(!n||!_){u("Não foi possível buscar a localização atual, tente novamente"),A();return}const G=i.empresaId,x=i.codigoUsuario,p=i.empresaCnpj;if(!Number(a.GAA_KM_INICIAL)&&Number(a.GAA_KM_INICIAL)===0&&!a.GAA_KM_FINAL&&a.GAA_KM_FINAL===0){u("Informe os dados do hodômetro");return}if(a.GAA_KM_FINAL&&a.GAA_KM_FINAL<a.GAA_KM_INICIAL){u("A quilometragem do fim do dia não pode ser menor que a do início");return}if(!a?.GKM_KM_INICIAL_FOTO&&M.img&&(a.GKM_KM_INICIAL_FOTO=await d(M.img,`Foto_inicio${M.fileExtension}`,"km inicio dia",x,p)),!a?.GKM_KM_FINAL_FOTO&&f.img&&(a.GKM_KM_FINAL_FOTO=await d(f.img,`Foto_fim${f.fileExtension}`,"km fim dia",x,p)),a?.GAA_KM_INICIAL&&!a.GKM_KM_INICIAL_FOTO){u("Adicione a foto do início do dia");return}if(a?.GAA_KM_FINAL&&!a.GKM_KM_FINAL_FOTO){u("Adicione a foto do fim do dia");return}const k={GKM_USR_AGENDA_ID:x,GKM_DATA:B(h,"yyyy-MM-dd"),GKM_KM_INICIAL:a?.GAA_KM_INICIAL,GKM_KM_INICIAL_DATA:a?.GKM_KM_INICIAL_FOTO&&!a?.GKM_KM_INICIAL_DATA?B(h,"yyyy-MM-dd hh:mm:ss"):a?.GKM_KM_INICIAL_DATA,GKM_KM_INICIAL_FOTO:a.GKM_KM_INICIAL_FOTO,GKM_KM_INICIAL_LATITUDE:a?.GKM_KM_INICIAL_FOTO&&!a?.GKM_KM_INICIAL_LATITUDE?n:a?.GKM_KM_INICIAL_LATITUDE,GKM_KM_INICIAL_LONGITUDE:a?.GKM_KM_INICIAL_FOTO&&!a?.GKM_KM_INICIAL_LONGITUDE?_:a?.GKM_KM_INICIAL_LONGITUDE,GKM_KM_FINAL:a?.GAA_KM_FINAL,GKM_KM_FINAL_DATA:a?.GKM_KM_FINAL_FOTO&&!a?.GKM_KM_FINAL_DATA?B(h,"yyyy-MM-dd hh:mm:ss"):a?.GKM_KM_FINAL_DATA,GKM_KM_FINAL_FOTO:a.GKM_KM_FINAL_FOTO,GKM_KM_FINAL_LATITUDE:a?.GKM_KM_FINAL_FOTO&&!a?.GKM_KM_FINAL_LATITUDE?n:a?.GKM_KM_FINAL_LATITUDE,GKM_KM_FINAL_LONGITUDE:a?.GKM_KM_FINAL_FOTO&&!a?.GKM_KM_FINAL_LONGITUDE?_:a?.GKM_KM_FINAL_LONGITUDE},o=await ee.post(`v2/trade/kmdriven/${G}/${x}`,k),{sucess:L,data:F}=o.data;if(L){let E=F;Array.isArray(F)&&(E=F[0]),a?.GKM_KM_FINAL_FOTO?ae("hodometroActive",!1):ae("hodometroActive",!0),ae("currentDrivenOdometro",E),w(E),c(!1),u("Salvo com sucesso",1)}}}catch{u("Não foi possível salvar")}finally{A()}}async function d(i,n,_,G,x){try{const p={fileName:n,id:1,imageData:i,uniqueid:_},k="/v2/trade/sync/image/"+x+"/"+G,o=await ee.post(k,p,{timeout:30*1e3}),{data:L}=o.data;if(ge(L))return L.urlPath}catch{u("Não foi possível salvar a foto")}}async function N(i){try{U(i);const n=V();if(n){v();const{latitude:_,longitude:G}=await Y();if(!_||!G){u("Não foi possível buscar a localização atual, tente novamente"),A();return}const x=n.empresaId,p=n.codigoUsuario,k=await ee.get(`v2/trade/kmdriven/${x}/${p}`,{params:{data:B(i,"dd-MM-yyyy"),usuarioAgenda:p}}),{data:o}=k.data;o&&(o&&o.length>0?(o[0].GAA_KM_INICIAL=o[0].GKM_KM_INICIAL,o[0].GAA_KM_FINAL=o[0].GKM_KM_FINAL,I({img:o[0].GKM_KM_INICIAL_FOTO,fileExtension:""}),g({img:o[0].GKM_KM_FINAL_FOTO,fileExtension:""}),w(o[0]),K("km_initial",o[0].GKM_KM_INICIAL),K("km_final",o[0].GKM_KM_FINAL)):(w({GKM_USR_AGENDA_ID:null,GKM_DATA:null,GKM_KM_INICIAL:null,GKM_KM_INICIAL_DATA:null,GKM_KM_INICIAL_FOTO:null,GKM_KM_INICIAL_LATITUDE:null,GKM_KM_INICIAL_LONGITUDE:null,GKM_KM_FINAL:null,GKM_KM_FINAL_DATA:null,GKM_KM_FINAL_FOTO:null,GKM_KM_FINAL_LATITUDE:null,GKM_KM_FINAL_LONGITUDE:null,GAA_KM_INICIAL:null,GAA_KM_FINAL:null}),K("km_initial",""),K("km_final",""),I({img:null,fileExtension:""}),g({img:null,fileExtension:""})))}}catch{u("Não foi possível buscar os dados desse dia")}finally{A()}}function K(i,n){const _=document.getElementById(i);_&&_.type==="number"?_.value=n:console.error("O elemento não foi encontrado ou não é um input do tipo number")}const y=l.useRef(!1);l.useEffect(()=>{y.current||(async function(){y.current=!0,N(new Date)})()},[]);const j=async i=>{const n=await P(i);n&&I({img:n.img,fileExtension:n.fileExtension})},D=async i=>{const n=await P(i);n&&g({img:n.img,fileExtension:n.fileExtension})};return e.jsx(_e,{open:s,onOpenChange:c,children:e.jsxs(Ie,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ae,{className:"bg-linear-to-r from-primary to-primary/80 text-white p-6 -m-6 mb-6 rounded-t-lg",children:e.jsxs(he,{className:"flex items-center gap-3 text-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5"})}),"Dados do Hodômetro"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-base font-semibold text-gray-700 border-l-4 border-primary pl-3",children:"Data"}),e.jsxs(Ce,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(C,{disabled:!r,variant:"outline",className:pe("w-full justify-start text-left font-normal h-12",!h&&"text-muted-foreground"),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),h?B(h,"dd/MM/yyyy"):e.jsx("span",{children:"Selecione uma data"})]})}),e.jsx(Oe,{className:"w-auto p-0",children:e.jsx(be,{mode:"single",selected:h,onSelect:i=>i&&N(i),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"km_initial",className:"text-base font-semibold text-gray-700 border-l-4 border-primary pl-3",children:"KM inicial do dia"}),e.jsx(re,{id:"km_initial",type:"number",placeholder:"Digite a quilometragem inicial",disabled:a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_INICIAL,value:a.GAA_KM_INICIAL||"",onChange:i=>w({...a,GAA_KM_INICIAL:i.target.value}),className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"photo-inicial",className:"text-base font-semibold text-gray-700 border-l-4 border-primary pl-3",children:"Foto do início do dia"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 hover:border-primary transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[M.img?e.jsx("img",{src:M.img,alt:"Foto inicial",className:"max-w-full h-auto rounded-lg"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(J,{className:"w-10 h-10 text-primary"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-zinc-600 mb-1",children:"Clique para adicionar uma foto"})}),e.jsx("input",{id:"photo-inicial",type:"file",accept:"image/*",capture:T?void 0:"environment",disabled:a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_INICIAL_FOTO,onChange:j,className:"hidden"}),e.jsxs(C,{type:"button",variant:"outline",onClick:()=>document.getElementById("photo-inicial")?.click(),className:"gap-2",disabled:O||a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_INICIAL_FOTO,children:[e.jsx(J,{size:16}),"Selecionar foto"]})]})})]}),a?.GKM_KM_INICIAL!==null&&a?.GKM_KM_INICIAL_FOTO&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"km_final",className:"text-base font-semibold text-gray-700 border-l-4 border-primary pl-3",children:"KM final do dia"}),e.jsx(re,{id:"km_final",type:"number",placeholder:"Digite a quilometragem final",disabled:a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_FINAL,value:a.GAA_KM_FINAL||"",onChange:i=>w({...a,GAA_KM_FINAL:i.target.value}),className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"photo-final",className:"text-base font-semibold text-gray-700 border-l-4 border-primary pl-3",children:"Foto do fim do dia"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 hover:border-primary transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[f.img?e.jsx("img",{src:f.img,alt:"Foto final",className:"max-w-full h-auto rounded-lg"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(J,{className:"w-10 h-10 text-primary"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-zinc-600 mb-1",children:"Clique para adicionar uma foto"})}),e.jsx("input",{id:"photo-final",type:"file",accept:"image/*",capture:T?void 0:"environment",onChange:D,disabled:a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_FINAL_FOTO,className:"hidden"}),e.jsxs(C,{type:"button",variant:"outline",onClick:()=>document.getElementById("photo-final")?.click(),className:"gap-2",disabled:O||a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_FINAL_FOTO,children:[e.jsx(J,{size:16}),"Selecionar foto"]})]})})]})]})]}),e.jsxs(xe,{className:"gap-2",children:[e.jsxs(C,{type:"button",variant:"outline",onClick:()=>c(!1),className:"gap-2",disabled:O,children:[e.jsx(ue,{size:16}),"Fechar"]}),e.jsxs(C,{type:"button",onClick:t,className:"gap-2 min-w-48 bg-primary",disabled:O||a.GKM_ID===r?.GKM_ID&&r?.GKM_KM_FINAL_FOTO,children:[e.jsx(J,{size:16}),O?"Carregando...":"Salvar"]})]})]})})}function ia({open:s,onOpenChange:c}){const[r,T]=l.useState(null),{showLoading:h,hideLoading:U}=ne();async function M(){const I=V();if(!I){u("Sessão expirada");return}const f=I.email;h("Gerando código");const g=await Fe(f);U(),g&&T(g)}return e.jsx(_e,{open:s,onOpenChange:c,children:e.jsxs(Ie,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ae,{className:"bg-linear-to-r from-primary to-primary/80 text-white p-6 -m-6 mb-6 rounded-t-lg",children:e.jsxs(he,{className:"flex items-center gap-3 text-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5"})}),"Código para limpeza de dados locais"]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("p",{className:"font-medium text-center text-zinc-600",children:["Segue abaixo o codigo para liberação de limpeza de dados locais, este código pode ser utilizado apenas ",e.jsx("strong",{children:"UMA"})," vez"]}),r&&e.jsxs("span",{className:"bg-primary/20 py-2 px-6 rounded-md border-dotted border-primary text-primary text-2xl font-bold flex items-center justify-center",children:[r,e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(r),u("Código copiado!",1)},className:"ml-2 p-1 rounded-md hover:bg-primary/30 transition-colors",children:e.jsx(Xe,{size:24})})]}),e.jsx(C,{className:"min-w-48",onClick:M,children:"Gerar código"})]}),e.jsx(xe,{className:"gap-2 mt-6",children:e.jsxs(C,{type:"button",variant:"outline",onClick:()=>c(!1),className:"gap-2",children:[e.jsx(ue,{size:16}),"Fechar"]})})]})})}function te({stopWatch:s,variant:c}){return c==="day-finalized"?e.jsx("div",{className:"w-full mb-4 overflow-hidden rounded-xl border border-red-900/30 bg-red-950 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-red-900 text-red-300",children:e.jsx("i",{children:e.jsx($e,{size:20})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-50",children:"Horário de Atendimento Encerrado"}),e.jsx("p",{className:"text-xs text-red-100",children:"O expediente de hoje foi finalizado"})]})]})}):c==="waiting-end"?e.jsxs("div",{className:"w-full mb-4 overflow-hidden rounded-xl border border-orange-900/30 bg-orange-950 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-900 text-orange-300",children:e.jsx("i",{children:e.jsx(de,{size:20})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-semibold text-orange-50",children:"Encerrando em Breve"}),e.jsx("p",{className:"text-xs text-orange-100",children:"Finalize seus atendimentos pendentes"})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-black/20 px-4 py-3 gap-1",children:[e.jsx("span",{className:"text-base font-medium text-orange-100",children:"Encerramento em"}),e.jsxs("span",{className:"font-mono text-xl font-bold tracking-wider text-orange-100",children:[s.hours.toString().padStart(2,"0"),":",s.minutes.toString().padStart(2,"0"),":",s.seconds.toString().padStart(2,"0")]})]})]}):e.jsxs("div",{className:"w-full mb-4 overflow-hidden rounded-xl border border-purple-900/30 bg-purple-950 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-900 text-purple-300",children:e.jsx("i",{children:e.jsx(de,{size:20})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-50",children:"Aguardando Horário de Início"}),e.jsx("p",{className:"text-xs text-purple-100",children:"O atendimento será liberado em breve"})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-black/20 px-4 py-3 gap-1",children:[e.jsx("span",{className:"text-base font-medium text-purple-100",children:"Início em"}),e.jsxs("span",{className:"font-mono text-xl font-bold tracking-wider text-purple-100",children:[s.hours.toString().padStart(2,"0"),":",s.minutes.toString().padStart(2,"0"),":",s.seconds.toString().padStart(2,"0")]})]})]})}const la=30*1e3;function se(s){const c=Math.abs(s);return{totalTimeInSeconds:c,hours:Math.floor(c/3600)%24,minutes:Math.floor(c/60)%60,seconds:c%60}}function me(s){if(!s)return null;const c=new Date,[r,T,h]=s.split(":",3).map(Number);return c.setHours(r,T,h||0,0),c}function ra(s){return Ue(new Date)!=="Sábado"?s:{...s,INICIO_JORNADA:s.INICIO_JORNADA_SA??s.INICIO_JORNADA,FIM_JORNADA:s.FIM_JORNADA_SA??s.FIM_JORNADA,INICIO_PARADA1:s.INICIO_PARADA1_SA??s.INICIO_PARADA1,FIM_PARADA1:s.FIM_PARADA1_SA??s.FIM_PARADA1,FORCAR_PARADA1:s.FORCAR_PARADA1_SA??s.FORCAR_PARADA1}}function oa(){const[s,c]=l.useState(se(0)),[r,T]=l.useState(!1),[h,U]=l.useState(!1),[M,I]=l.useState(!1),f=l.useRef(null),g=l.useRef(null),a=l.useRef(null),w=l.useRef(null),v=l.useRef(!1),A=l.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null),g.current&&(clearInterval(g.current),g.current=null)},[]),O=l.useCallback(d=>{c(se(d))},[]),S=l.useCallback(d=>{const N=new Date,K=a.current,y=w.current;if(!K||!y){I(!0);return}const j=oe(N,K),D=oe(N,y);if(D>0){I(!1),T(!0),A();return}if(d)I(!0);else{if(j<0){I(!1),O(j);return}I(!0)}D>=-1800&&D!==0?(U(!0),O(D)):(U(!1),(d||j>=0)&&A())},[O,A]),P=l.useCallback(d=>{A(),f.current=setInterval(()=>{c(N=>N.totalTimeInSeconds>0?se(N.totalTimeInSeconds-1):(S(d),N))},1e3),g.current=setInterval(()=>{S(d)},la)},[A,S]),t=l.useCallback(d=>{if(!d?.HORARIOS_TRABALHO)return d;const N=d.HORARIOS_TRABALHO;if(Object.keys(N).length===0)return I(!0),{...d,HORARIOS_TRABALHO:{...N,Released:!0}};const K=ra(N),y=me(K.INICIO_JORNADA),j=me(K.FIM_JORNADA);if(a.current=y,w.current=j,!y||!j)return I(!0),{...d,HORARIOS_TRABALHO:{...K,Released:!0}};const D=!d.endAttendances&&!!d.startAttendances;return S(D),v.current||(P(D),v.current=!0),{...d,HORARIOS_TRABALHO:{...K,Released:M}}},[S,P,M]);return l.useEffect(()=>()=>{A(),v.current=!1},[A]),{stopWatch:s,isDayFinalized:r,isCheckMinutesForEnd:h,isReleased:M,initializeSchedule:t}}function Sa(){const[s,c]=l.useState(null),[r,T]=l.useState(!1),[h,U]=l.useState(null),[M,I]=l.useState(!1),[f,g]=l.useState(!1),[a,w]=l.useState({GKM_USR_AGENDA_ID:null,GKM_DATA:null,GKM_KM_INICIAL:null,GKM_KM_INICIAL_DATA:null,GKM_KM_INICIAL_FOTO:null,GKM_KM_INICIAL_LATITUDE:null,GKM_KM_INICIAL_LONGITUDE:null,GKM_KM_FINAL:null,GKM_KM_FINAL_DATA:null,GKM_KM_FINAL_FOTO:null,GKM_KM_FINAL_LATITUDE:null,GKM_KM_FINAL_LONGITUDE:null}),{stopWatch:v,isDayFinalized:A,isCheckMinutesForEnd:O,isReleased:S,initializeSchedule:P}=oa(),{data:t,isLoading:d,isFetching:N}=Te(),K=Ke(),y=ye(),{showLoading:j,hideLoading:D}=ne();async function i(){try{if(!await je({title:"Iniciar atendimento",component:e.jsx("span",{className:"font-bold text-lg text-center",children:"Deseja iniciar o atendimento?"}),confirm:"Iniciar"}))return;j("Iniciando atendimento");const R=s?.gmovelHodometro,$=await le("currentDrivenOdometro");if(R&&t?.scheduleData!==void 0&&t?.scheduleData.status===void 0&&!t?.scheduleData?.sucessStarted&&(!$||!$.GKM_KM_INICIAL_FOTO&&!$.GKM_KM_INICIAL)){u("Para iniciar o dia, é necessário informar o KM inicial, e a foto");return}const{latitude:H,longitude:b}=await Y();if(!H||!b){u("Não foi possível buscar a localização atual, tente novamente"),D();return}if(t?.scheduleData.status===void 0){const X=ce(new Date),z=await Re(t?.scheduleData,t?.scheduleData?.GAA_ID,H,b,X);if(z===void 0){u(`Não é possível continuar, o dia não foi iniciado.
Verifique sua conexão com a internet e se seu GPS está ativo`);return}if(z&&z.sucessStarted){z.status=2;const q={};q.dataHoraInicio=X,q.latitude=H,q.longitude=b,z.startAttendances=q,await Le(z),y("/customer-service")}else{u("Não foi possível iniciar o atendimento, tente novamente");return}}}catch(m){Be(m,!1)}finally{D()}}function n(m){K.setQueryData(["getScheduleHome"],()=>m)}async function _(){const{latitude:m,longitude:R}=await Y();if(!m||!R){u("Não foi possível buscar a localização atual, tente novamente"),D();return}const H=V().gmovelHodometro,b=await le("currentDrivenOdometro"),X=B(new Date,"dd/MM/yyyy"),z=b?.GKM_KM_INICIAL_DATA?B(new Date(b?.GKM_KM_INICIAL_DATA),"dd/MM/yyyy"):null;if(H&&!b&&!b?.GKM_KM_FINAL&&!b?.GKM_KM_FINAL_FOTO&&z&&X!==z){u("Para finalizar o dia, é necessário informar o KM final, e a foto");return}j("Finalizando o dia");const q=ce(new Date),Ne=await ke(t?.scheduleData,t?.scheduleData?.GAA_ID,m,R,q,j);D(),Ne&&y("/expired")}const G=l.useRef(!1);l.useEffect(()=>((async function(){if(G.current)return;const R=V();if(c(R),t){const $=await we();U($),G.current=!0;const H=P(t.scheduleData);if(H!==t.scheduleData&&(t.scheduleData=H,n(t)),R.gmovelHodometro||R.gmovelHodometroD){const b=await Se(t?.scheduleData);b&&w(b)}}})(),()=>{G.current=!1}),[t]);const x=t?.allScheduleData&&t?.allScheduleData.length===0||!t,p=t?.allScheduleData&&t.allScheduleData.length>0,k=h!==void 0&&t?.scheduleData&&t?.scheduleData?.GAA_DTA_AGENDA===h?.GAA_DTA_AGENDA,o=t&&t?.scheduleData&&t?.scheduleData?.GAA_DTA_AGENDA===He()&&t?.scheduleData?.CLIENTES[0]?.SEQ_PADRAO!==-1,L=t?.scheduleData&&Object.keys(t?.scheduleData?.HORARIOS_TRABALHO).length!==0,F=L&&!t?.scheduleData?.startAttendances?!S||A:!1,E=L&&!S&&!A,ie=t?.scheduleData?.CLIENTES&&t.scheduleData.CLIENTES.length>0,Z=s?.gmovelHodometro||s?.gmovelHodometroD;return d||N?e.jsx(De,{loadingTrue:!0}):e.jsxs("div",{className:"min-h-full background-pages",children:[e.jsxs("main",{className:"max-w-4xl mx-auto px-2 pb-4 pt-4 lg:pt-18",children:[e.jsxs("div",{className:"flex items-center gap-3 justify-start w-1/3",children:[s?.isAdmin&&e.jsx(C,{onClick:()=>I(!0),variant:"default",className:"flex-1 gap-2 size-10 rounded-full",children:e.jsx(fe,{size:20,className:"text-white"})}),Z&&e.jsx(C,{onClick:()=>g(!0),variant:"default",className:"flex-1 gap-2 size-10 rounded-full",disabled:!t||!t?.scheduleData,children:e.jsx(Qe,{size:20,className:"text-white"})}),e.jsx(C,{onClick:()=>y("/service-admin"),variant:"default",className:"flex-1 gap-2 size-10 rounded-full",children:e.jsx(sa,{size:20,className:"text-white"})})]}),e.jsx("div",{className:"flex items-center justify-center my-3 text-center",children:e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Agenda"})}),x&&e.jsxs("div",{className:"flex flex-col gap-2 mt-6",children:[e.jsxs(C,{onClick:()=>y(0),children:[e.jsx("i",{children:e.jsx(qe,{size:20,className:"text-white"})}),"Atualizar"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-[#d5b5e3] p-6 text-center",children:e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Sem atividades agendadas"})})]}),p&&e.jsx("div",{className:"bg-white rounded-2xl shadow-sm mb-2 flex gap-2 overflow-x-auto",children:t?.allScheduleData?.map((m,R)=>e.jsx("button",{onClick:()=>{t.scheduleData=t?.allScheduleData[R],n(t),T(!r)},className:`flex-1 py-4 px-4 rounded-xl transition-all border min-w-[120px] ${t?.scheduleData?.GAA_ID===m.GAA_ID?"bg-primary text-white shadow-md ":"bg-white text-primary border-primary/30 hover:bg-primary/20"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-base font-semibold ${t?.scheduleData?.GAA_ID===m.GAA_ID?"text-white":"text-zinc-600"}`,children:Pe(m.GAA_DTA_AGENDA)}),e.jsx("span",{className:`font-bold ${t?.scheduleData?.GAA_ID===m.GAA_ID?"text-white":"text-zinc-950"}`,children:m.GAA_DTA_AGENDA})]})},m.GAA_DTA_AGENDA))}),k&&e.jsxs(C,{onClick:_,className:" w-full py-6 my-3",children:[e.jsx(Je,{size:22}),"Finalizar dia"]}),o&&e.jsx("button",{disabled:F,onClick:async()=>{!t.scheduleData.status&&!t.scheduleData.sucessStarted?await i():y("/customer-service")},className:Ge("w-full bg-white font-medium text-primary py-4 rounded-2xl my-3 drop-shadow-sm drop-shadow-primary transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",t.scheduleData.status&&t.scheduleData.sucessStarted&&"bg-linear-to-br from-primary/75 via-primary to-primary/75 text-white"),children:!t.scheduleData.status&&!t.scheduleData.sucessStarted?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:20}),e.jsx("span",{className:"text-lg",children:"Iniciar atendimento"})]}):e.jsxs(e.Fragment,{children:[e.jsx(aa,{size:20}),e.jsx("span",{className:"text-lg",children:"Continuar atendimento"})]})}),E&&e.jsx(te,{stopWatch:v,variant:"waiting-start"}),A&&e.jsx(te,{stopWatch:v,variant:"day-finalized"}),O&&e.jsx(te,{stopWatch:v,variant:"waiting-end"}),ie&&e.jsx("div",{className:"space-y-4",children:t.scheduleData.CLIENTES.map(m=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-[#d5b5e3] hover:shadow-lg transition-all hover:border-[#bf8fd6] cursor-pointer group overflow-hidden",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"shrink-0 w-12 h-12 rounded-xl bg-linear-to-br from-primary to-primary/75 flex items-center justify-center",children:e.jsx(We,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary text-white text-xs font-medium rounded-full",children:m.CLI_CODIGO}),e.jsx("h3",{className:"text-gray-900 font-bold",children:m.CLI_NOME_FANTASIA})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["(",m.CLI_RAZAO_SOCIAL,")"]}),e.jsx("p",{className:"text-sm text-gray-600",children:m.CLI_ENDERECO})]})]})})},m.CLI_CODIGO))})]}),f&&e.jsx(na,{open:f,onOpenChange:g,currentDrivenOdometro:a,HodometroD:s?.gmovelHodometroD||!1}),M&&e.jsx(ia,{open:M,onOpenChange:()=>I(!1)})]})}export{Sa as default};
