import{I as Xt,V as R,a3 as Vt,R as w,Z as M,W as te,S as I,ac as et,ar as dt,U as b,as as $t,at as ee,au as re,av as ae,aj as ne,aw as se,a4 as oe}from"./index-CYXlB6di.js";import{A as T}from"./apiEndpoints-aSQtSIWE.js";import{f as J}from"./currency-CxFzcO-j.js";import{b as ie,g as $}from"./timesAndDates-BA0J74pm.js";import{h as L}from"./handleApiError-Mr_6qIMG.js";import{f as rt}from"./format-BBYAYFtJ.js";import{u as ce}from"./useQuery-hx1aMKYH.js";const ue=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Je=Xt("circle-play",ue);async function le(t,e,r,a,n="N"){if(t===r&&e===a)return 0;{const s=Math.PI*t/180,u=Math.PI*r/180,i=e-a,o=Math.PI*i/180;let c=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos(o);return c>1&&(c=1),c=Math.acos(c),c=c*180/Math.PI,c=c*60*1.1515,n==="K"&&(c=c*1.609344),n==="N"&&(c=c*.8684),c}}function kt(){return new Promise(t=>{if(!navigator.geolocation){t({latitude:null,longitude:null,accuracy:null,error:"Geolocalização não é suportada neste navegador."});return}let e=!1,r=null,a=null;const n=u=>{e||(e=!0,r!==null&&navigator.geolocation.clearWatch(r),a!==null&&clearTimeout(a),t(u))};a=setTimeout(()=>{n({latitude:null,longitude:null,accuracy:null,error:"Tempo limite excedido. Verifique se o seu GPS está ligado e se o navegador tem permissão."})},35e3);const s={enableHighAccuracy:!0,timeout:15e3,maximumAge:5e3};navigator.geolocation.getCurrentPosition(u=>{n({latitude:u.coords.latitude,longitude:u.coords.longitude,accuracy:u.coords.accuracy,error:null})},u=>{if(console.warn("Erro getCurrentPosition:",u),u.code===1){n({latitude:null,longitude:null,accuracy:null,error:"Permissão de localização negada. Por favor, habilite o acesso ao GPS nas configurações do seu navegador/aparelho."});return}r=navigator.geolocation.watchPosition(i=>{n({latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy,error:null})},i=>{console.warn("Erro watchPosition:",i),i.code===1&&n({latitude:null,longitude:null,accuracy:null,error:"Permissão de localização negada."})},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})},s)})}async function We(t){try{const e=R();let r=null,a=null;if(e&&(r=e.empresaId,a=e.codigoUsuario),!r||!a)return;const n=await Vt("currentDrivenOdometro");if(t&&t?.emAtendimento&&n)return;let s=rt(new Date,"dd/MM/yyyy");t&&t.status!==void 0&&(s=t.GAA_DTA_AGENDA);const u=await w.get(`${T.TRADE.KM_DRIVEN}/${r}/${a}`,{params:{data:s,usuarioAgenda:a}}),{data:i}=u.data;return M(i)?(te("currentDrivenOdometro",i[0]),i[0]):null}catch(e){return L(e,null)}}async function Ye(t){try{const e=await w.post(T.AUTH.GENERATE_PWD,{usrEmail:t}),{data:r}=e.data;return M(r)?r:!1}catch{return I("Não foi possível gerar o código"),!1}}async function Ke(t,e,r,a,n=!1){try{const s=R();if(s){const u=s.empresaId,i=s.codigoUsuario;if(t.CLI_LATITUDE!==null&&t.CLI_LONGITUDE!==null&&(t.status!==1||n)&&(t.galId!==!1||n)){let o=await le(t.CLI_LATITUDE,t.CLI_LONGITUDE,r,a,"K");o=o*1e3;const c=e.HORARIOS_TRABALHO.RAIO_ATENDIMENTO,p=e.GAA_ID;if(o>c){const l=fe(t?.alert),d=ie(new Date),S=o>1e3?parseFloat(J(o/1e3)):parseFloat(J(o)),P=o>1e3?`${parseFloat(J(o/1e3))}km`:`${parseFloat(J(o))}m`;if(l&&!n&&l?.distanceNumber>=S)return l.GTI_DESCRICAO=l.descricao,l.GAL_ID=l.galId,l.GTI_FLG_IMPEDE_ATD=l.liberado?0:1,l.GAL_FLG_STATUS=l.lido?1:0,[l];const v={gaaId:p,gatId:t.gatId,gtiId:10,observacao:`CLIENTE: ${t.CLI_CODIGO} - ${t.CLI_NOME_FANTASIA}, ${d}, DISTÂNCIA: ${P} [${t.CLI_LATITUDE}:${t.CLI_LONGITUDE}|${r}:${a}]`},g=await w.post(`${T.TRADE.ADD_ALERT}/${u}/${i}`,v);if(g.data.sucess){const m={galId:g.data.data.galId},E=await w.post(`${T.TRADE.ALERT_RESPONSE}/${u}/${i}`,m),{sucess:D,data:y}=E.data;if(D)return y.map(f=>(f.DISTANCE=P,f.distanceNumber=S,f))}}else return!1}else return!1}else return!1}catch{return!1}}function fe(t){return Array.isArray(t)?t.some(e=>e.liberado===!0):typeof t=="object"&&t!==null?t.liberado===!0:!1}async function Ze(t,e,r){try{const a=R();if(a){const n=a.empresaId,s=a.codigoUsuario,u=await w.post(`${T.TRADE.ALERT_RESPONSE}/${n}/${s}`,{galId:t.galId});return u.data.data.find(i=>i.GAL_FLG_LIBERA_ATD===1&&i.GTI_FLG_IMPEDE_ATD===1)?{pos:e.CLIENTES.findIndex(c=>c.SEQ_PADRAO===t.SEQ_PADRAO),status:1}:u.data.data.find(i=>i.GAL_FLG_LIBERA_ATD===0&&i.GTI_FLG_IMPEDE_ATD===1&&i.GAL_FLG_STATUS===1)?{pos:e.CLIENTES.findIndex(c=>c.SEQ_PADRAO===t.SEQ_PADRAO),status:-1}:(r===1&&I("Ainda não foi liberado!",2),!1)}else return!1}catch{I("Não foi possível verificar!",2)}}async function Xe(t){try{const e=R();if(e){const r=e.empresaId,a=e.codigoUsuario,n=t||rt(new Date,"dd/MM/yyyy"),s=await w.get(`${T.TRADE.SYNC.DB}/${r}/${a}`,{params:{data:n}}),{sucess:u,data:i}=s.data;if(u&&i&&i.length>0){const o=i.sort((c,p)=>{const l=Ot(c?.DATA),d=Ot(p?.DATA);return!l||!d?l?1:d?-1:0:l.getTime()-d.getTime()});return o.sort((c,p)=>p?.HORA?.localeCompare(c?.HORA)),o}return null}else return null}catch{return null}}function Ot(t){if(!t)return null;const[e,r,a]=t.split("/").map(Number);return new Date(a,r-1,e)}async function Ve(t){try{const e=R();if(e){const r=e.empresaId,a=e.codigoUsuario,n=await w.get(`${T.TRADE.SYNC.DB}/${r}/${a}/${t}`),{sucess:s,data:u}=n.data;return s&&u&&u.length>0?u:null}else return null}catch{return null}}async function tr(){try{const t=R();if(t){const e=t.empresaId,r=t.codigoUsuario,a=await w.get(`${T.TRADE.FILE}/${e}/${r}`),{sucess:n,data:s}=a.data;n&&(s.GSTO_FILE?await et(s.GSTO_FILE):await dt("scheduleData"))}}catch{return I("Erro ao fazer download dos dados"),!1}}var xt=Symbol.for("immer-nothing"),Rt=Symbol.for("immer-draftable"),O=Symbol.for("immer-state");function C(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var N=Object,k=N.getPrototypeOf,Z="constructor",at="prototype",pt="configurable",X="enumerable",Y="writable",B="value",F=t=>!!t&&!!t[O];function G(t){return t?bt(t)||nt(t)||!!t[Rt]||!!t[Z]?.[Rt]||st(t)||ot(t):!1}var de=N[at][Z].toString(),Nt=new WeakMap;function bt(t){if(!t||!vt(t))return!1;const e=k(t);if(e===null||e===N[at])return!0;const r=N.hasOwnProperty.call(e,Z)&&e[Z];if(r===Object)return!0;if(!z(r))return!1;let a=Nt.get(r);return a===void 0&&(a=Function.toString.call(r),Nt.set(r,a)),a===de}function H(t,e,r=!0){Q(t)===0?(r?Reflect.ownKeys(t):N.keys(t)).forEach(n=>{e(n,t[n],t)}):t.forEach((a,n)=>e(n,a,t))}function Q(t){const e=t[O];return e?e.type_:nt(t)?1:st(t)?2:ot(t)?3:0}var Lt=(t,e,r=Q(t))=>r===2?t.has(e):N[at].hasOwnProperty.call(t,e),_t=(t,e,r=Q(t))=>r===2?t.get(e):t[e],V=(t,e,r,a=Q(t))=>{a===2?t.set(e,r):a===3?t.add(r):t[e]=r};function pe(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}var nt=Array.isArray,st=t=>t instanceof Map,ot=t=>t instanceof Set,vt=t=>typeof t=="object",z=t=>typeof t=="function",ut=t=>typeof t=="boolean",U=t=>t.copy_||t.base_,Et=t=>t.modified_?t.copy_:t.base_;function At(t,e){if(st(t))return new Map(t);if(ot(t))return new Set(t);if(nt(t))return Array[at].slice.call(t);const r=bt(t);if(e===!0||e==="class_only"&&!r){const a=N.getOwnPropertyDescriptors(t);delete a[O];let n=Reflect.ownKeys(a);for(let s=0;s<n.length;s++){const u=n[s],i=a[u];i[Y]===!1&&(i[Y]=!0,i[pt]=!0),(i.get||i.set)&&(a[u]={[pt]:!0,[Y]:!0,[X]:i[X],[B]:t[u]})}return N.create(k(t),a)}else{const a=k(t);if(a!==null&&r)return{...t};const n=N.create(a);return N.assign(n,t)}}function wt(t,e=!1){return it(t)||F(t)||!G(t)||(Q(t)>1&&N.defineProperties(t,{set:W,add:W,clear:W,delete:W}),N.freeze(t),e&&H(t,(r,a)=>{wt(a,!0)},!1)),t}function _e(){C(2)}var W={[B]:_e};function it(t){return t===null||!vt(t)?!0:N.isFrozen(t)}var tt="MapSet",yt="Patches",Bt={};function x(t){const e=Bt[t];return e||C(0,t),e}var Ae=t=>!!Bt[t],j,jt=()=>j,ye=(t,e)=>({drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Ae(tt)?x(tt):void 0});function Ct(t,e){e&&(t.patchPlugin_=x(yt),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function ht(t){St(t),t.drafts_.forEach(he),t.drafts_=null}function St(t){t===j&&(j=t.parent_)}var Ut=t=>j=ye(j,t);function he(t){const e=t[O];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Gt(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];if(t!==void 0&&t!==r){r[O].modified_&&(ht(e),C(4)),G(t)&&(t=Ft(e,t));const{patchPlugin_:n}=e;n&&n.generateReplacementPatches_(r[O].base_,t,e)}else t=Ft(e,r);return Se(e,t,!0),ht(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==xt?t:void 0}function Ft(t,e){if(it(e))return e;const r=e[O];if(!r)return It(e,t.handledSet_,t);if(!ct(r,t))return e;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:a}=r;if(a)for(;a.length>0;)a.pop()(t);Qt(r,t)}return r.copy_}function Se(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&wt(e,r)}function qt(t){t.finalized_=!0,t.scope_.unfinalizedDrafts_--}var ct=(t,e)=>t.scope_===e,me=[];function Ht(t,e,r,a){const n=U(t),s=t.type_;if(a!==void 0&&_t(n,a,s)===e){V(n,a,r,s);return}if(!t.draftLocations_){const i=t.draftLocations_=new Map;H(n,(o,c)=>{if(F(c)){const p=i.get(c)||[];p.push(o),i.set(c,p)}})}const u=t.draftLocations_.get(e)??me;for(const i of u)V(n,i,r,s)}function ge(t,e,r){t.callbacks_.push(function(n){const s=e;if(!s||!ct(s,n))return;n.mapSetPlugin_?.fixSetContents(s);const u=Et(s);Ht(t,s.draft_??s,u,r),Qt(s,n)})}function Qt(t,e){if(t.modified_&&!t.finalized_&&(t.type_===3||(t.assigned_?.size??0)>0)){const{patchPlugin_:a}=e;if(a){const n=a.getPath(t);n&&a.generatePatches_(t,n,e)}qt(t)}}function De(t,e,r){const{scope_:a}=t;if(F(r)){const n=r[O];ct(n,a)&&n.callbacks_.push(function(){K(t);const u=Et(n);Ht(t,r,u,e)})}else G(r)&&t.callbacks_.push(function(){const s=U(t);_t(s,e,t.type_)===r&&a.drafts_.length>1&&(t.assigned_.get(e)??!1)===!0&&t.copy_&&It(_t(t.copy_,e,t.type_),a.handledSet_,a)})}function It(t,e,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||F(t)||e.has(t)||!G(t)||it(t)||(e.add(t),H(t,(a,n)=>{if(F(n)){const s=n[O];if(ct(s,r)){const u=Et(s);V(t,a,u,t.type_),qt(s)}}else G(n)&&It(n,e,r)})),t}function ve(t,e){const r=nt(t),a={type_:r?1:0,scope_:e?e.scope_:jt(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let n=a,s=Pt;r&&(n=[a],s=q);const{revoke:u,proxy:i}=Proxy.revocable(n,s);return a.draft_=i,a.revoke_=u,[i,a]}var Pt={get(t,e){if(e===O)return t;const r=U(t);if(!Lt(r,e,t.type_))return Ee(t,r,e);const a=r[e];if(t.finalized_||!G(a))return a;if(a===lt(t.base_,e)){K(t);const n=t.type_===1?+e:e,s=gt(t.scope_,a,t,n);return t.copy_[n]=s}return a},has(t,e){return e in U(t)},ownKeys(t){return Reflect.ownKeys(U(t))},set(t,e,r){const a=Jt(U(t),e);if(a?.set)return a.set.call(t.draft_,r),!0;if(!t.modified_){const n=lt(U(t),e),s=n?.[O];if(s&&s.base_===r)return t.copy_[e]=r,t.assigned_.set(e,!1),!0;if(pe(r,n)&&(r!==void 0||Lt(t.base_,e,t.type_)))return!0;K(t),mt(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_.set(e,!0),De(t,e,r)),!0},deleteProperty(t,e){return K(t),lt(t.base_,e)!==void 0||e in t.base_?(t.assigned_.set(e,!1),mt(t)):t.assigned_.delete(e),t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=U(t),a=Reflect.getOwnPropertyDescriptor(r,e);return a&&{[Y]:!0,[pt]:t.type_!==1||e!=="length",[X]:a[X],[B]:r[e]}},defineProperty(){C(11)},getPrototypeOf(t){return k(t.base_)},setPrototypeOf(){C(12)}},q={};H(Pt,(t,e)=>{q[t]=function(){const r=arguments;return r[0]=r[0][0],e.apply(this,r)}});q.deleteProperty=function(t,e){return q.set.call(this,t,e,void 0)};q.set=function(t,e,r){return Pt.set.call(this,t[0],e,r,t[0])};function lt(t,e){const r=t[O];return(r?U(r):t)[e]}function Ee(t,e,r){const a=Jt(e,r);return a?B in a?a[B]:a.get?.call(t.draft_):void 0}function Jt(t,e){if(!(e in t))return;let r=k(t);for(;r;){const a=Object.getOwnPropertyDescriptor(r,e);if(a)return a;r=k(r)}}function mt(t){t.modified_||(t.modified_=!0,t.parent_&&mt(t.parent_))}function K(t){t.copy_||(t.assigned_=new Map,t.copy_=At(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var we=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(e,r,a)=>{if(z(e)&&!z(r)){const s=r;r=e;const u=this;return function(o=s,...c){return u.produce(o,p=>r.call(this,p,...c))}}z(r)||C(6),a!==void 0&&!z(a)&&C(7);let n;if(G(e)){const s=Ut(this),u=gt(s,e,void 0);let i=!0;try{n=r(u),i=!1}finally{i?ht(s):St(s)}return Ct(s,a),Gt(n,s)}else if(!e||!vt(e)){if(n=r(e),n===void 0&&(n=e),n===xt&&(n=void 0),this.autoFreeze_&&wt(n,!0),a){const s=[],u=[];x(yt).generateReplacementPatches_(e,n,{patches_:s,inversePatches_:u}),a(s,u)}return n}else C(1,e)},this.produceWithPatches=(e,r)=>{if(z(e))return(u,...i)=>this.produceWithPatches(u,o=>e(o,...i));let a,n;return[this.produce(e,r,(u,i)=>{a=u,n=i}),a,n]},ut(t?.autoFreeze)&&this.setAutoFreeze(t.autoFreeze),ut(t?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),ut(t?.useStrictIteration)&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){G(t)||C(8),F(t)&&(t=Ie(t));const e=Ut(this),r=gt(e,t,void 0);return r[O].isManual_=!0,St(e),r}finishDraft(t,e){const r=t&&t[O];(!r||!r.isManual_)&&C(9);const{scope_:a}=r;return Ct(a,e),Gt(void 0,a)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const n=e[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(e=e.slice(r+1));const a=x(yt).applyPatches_;return F(t)?a(t,e):this.produce(t,n=>a(n,e))}};function gt(t,e,r,a){const[n,s]=st(e)?x(tt).proxyMap_(e,r):ot(e)?x(tt).proxySet_(e,r):ve(e,r);return(r?.scope_??jt()).drafts_.push(n),s.callbacks_=r?.callbacks_??[],s.key_=a,r&&a!==void 0?ge(r,s,a):s.callbacks_.push(function(o){o.mapSetPlugin_?.fixSetContents(s);const{patchPlugin_:c}=o;s.modified_&&c&&c.generatePatches_(s,[],o)}),n}function Ie(t){return F(t)||C(10,t),Wt(t)}function Wt(t){if(!G(t)||it(t))return t;const e=t[O];let r,a=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=At(t,e.scope_.immer_.useStrictShallowCopy_),a=e.scope_.immer_.shouldUseStrictIteration()}else r=At(t,!0);return H(r,(n,s)=>{V(r,n,Wt(s))},a),e&&(e.finalized_=!1),r}var Pe=new we,Te=Pe.produce,ft={exports:{}},Mt;function Oe(){return Mt||(Mt=1,(function(t){var e=(function(){var r=String.fromCharCode,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function u(o,c){if(!s[o]){s[o]={};for(var p=0;p<o.length;p++)s[o][o.charAt(p)]=p}return s[o][c]}var i={compressToBase64:function(o){if(o==null)return"";var c=i._compress(o,6,function(p){return a.charAt(p)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:i._decompress(o.length,32,function(c){return u(a,o.charAt(c))})},compressToUTF16:function(o){return o==null?"":i._compress(o,15,function(c){return r(c+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:i._decompress(o.length,16384,function(c){return o.charCodeAt(c)-32})},compressToUint8Array:function(o){for(var c=i.compress(o),p=new Uint8Array(c.length*2),l=0,d=c.length;l<d;l++){var S=c.charCodeAt(l);p[l*2]=S>>>8,p[l*2+1]=S%256}return p},decompressFromUint8Array:function(o){if(o==null)return i.decompress(o);for(var c=new Array(o.length/2),p=0,l=c.length;p<l;p++)c[p]=o[p*2]*256+o[p*2+1];var d=[];return c.forEach(function(S){d.push(r(S))}),i.decompress(d.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":i._compress(o,6,function(c){return n.charAt(c)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(c){return u(n,o.charAt(c))}))},compress:function(o){return i._compress(o,16,function(c){return r(c)})},_compress:function(o,c,p){if(o==null)return"";var l,d,S={},P={},v="",g="",m="",E=2,D=3,y=2,h=[],f=0,A=0,_;for(_=0;_<o.length;_+=1)if(v=o.charAt(_),Object.prototype.hasOwnProperty.call(S,v)||(S[v]=D++,P[v]=!0),g=m+v,Object.prototype.hasOwnProperty.call(S,g))m=g;else{if(Object.prototype.hasOwnProperty.call(P,m)){if(m.charCodeAt(0)<256){for(l=0;l<y;l++)f=f<<1,A==c-1?(A=0,h.push(p(f)),f=0):A++;for(d=m.charCodeAt(0),l=0;l<8;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1}else{for(d=1,l=0;l<y;l++)f=f<<1|d,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=0;for(d=m.charCodeAt(0),l=0;l<16;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1}E--,E==0&&(E=Math.pow(2,y),y++),delete P[m]}else for(d=S[m],l=0;l<y;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1;E--,E==0&&(E=Math.pow(2,y),y++),S[g]=D++,m=String(v)}if(m!==""){if(Object.prototype.hasOwnProperty.call(P,m)){if(m.charCodeAt(0)<256){for(l=0;l<y;l++)f=f<<1,A==c-1?(A=0,h.push(p(f)),f=0):A++;for(d=m.charCodeAt(0),l=0;l<8;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1}else{for(d=1,l=0;l<y;l++)f=f<<1|d,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=0;for(d=m.charCodeAt(0),l=0;l<16;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1}E--,E==0&&(E=Math.pow(2,y),y++),delete P[m]}else for(d=S[m],l=0;l<y;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1;E--,E==0&&(E=Math.pow(2,y),y++)}for(d=2,l=0;l<y;l++)f=f<<1|d&1,A==c-1?(A=0,h.push(p(f)),f=0):A++,d=d>>1;for(;;)if(f=f<<1,A==c-1){h.push(p(f));break}else A++;return h.join("")},decompress:function(o){return o==null?"":o==""?null:i._decompress(o.length,32768,function(c){return o.charCodeAt(c)})},_decompress:function(o,c,p){var l=[],d=4,S=4,P=3,v="",g=[],m,E,D,y,h,f,A,_={val:p(0),position:c,index:1};for(m=0;m<3;m+=1)l[m]=m;for(D=0,h=Math.pow(2,2),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;switch(D){case 0:for(D=0,h=Math.pow(2,8),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;A=r(D);break;case 1:for(D=0,h=Math.pow(2,16),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;A=r(D);break;case 2:return""}for(l[3]=A,E=A,g.push(A);;){if(_.index>o)return"";for(D=0,h=Math.pow(2,P),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;switch(A=D){case 0:for(D=0,h=Math.pow(2,8),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;l[S++]=r(D),A=S-1,d--;break;case 1:for(D=0,h=Math.pow(2,16),f=1;f!=h;)y=_.val&_.position,_.position>>=1,_.position==0&&(_.position=c,_.val=p(_.index++)),D|=(y>0?1:0)*f,f<<=1;l[S++]=r(D),A=S-1,d--;break;case 2:return g.join("")}if(d==0&&(d=Math.pow(2,P),P++),l[A])v=l[A];else if(A===S)v=E+E.charAt(0);else return null;g.push(v),l[S++]=E+v.charAt(0),d--,E=v,d==0&&(d=Math.pow(2,P),P++)}}};return i})();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(ft)),ft.exports}var Dt=Oe();function er(){return ce({queryKey:["getScheduleHome"],queryFn:async()=>await Re(),staleTime:0})}async function Re(){try{const t=R();if(t){const e=t.empresaId,r=t.codigoUsuario,{latitude:a,longitude:n}=await kt();let s;const u=[],i=await b();if(r===i?.GAA_USR_ID_AGENDA&&(i?.sucessStarted||i!==void 0&&i.REN_FLG_STATUS!==0&&i.status!==void 0))return s=i,u.push(s),{scheduleData:s,allScheduleData:u};const o=T.SCHEDULE.BASE+"/"+e+"/"+r,c={usuarioAgenda:r,status:1,dataInicial:$(),dataFinal:$(7),latitude:a,longitude:n},p=await w.post(o,c),{sucess:l,data:d}=p.data;if(l&&d&&d.length>0){const v=d;for(const g of v)u.push(g)}if(u!==void 0){const v=$();for(const g of u)if(g.GAA_DTA_AGENDA===v)if(g.diaSemana="Hoje",g.GAA_GAF_ID){const m=await zt(e,r,g.GAA_GAF_ID);m&&(g.PESQUISAS=m.PESQUISAS)}else{const m=g?.FLUXOS?.map(y=>y.GFL_GAF_ID)||[],E=await Promise.all(m.map(async y=>{const h=await zt(e,r,y);return h?h.PESQUISAS:[]})),D=[...g.PESQUISAS||[],...E.flat()];g.PESQUISAS=Array.from(new Map(D.map(y=>[y.GFP_GAP_ID,y])).values())}}const S=await Le(e,r,u);return S?{scheduleData:S?.scheduleData,allScheduleData:S?.allScheduleData}:{scheduleData:await Ne(0,!1,u),allScheduleData:u}}}catch(t){return I(String(t)),{scheduleData:null,allScheduleData:[]}}}async function Ne(t,e,r){try{let a;const n=await Me();let s;if(!e){if(!r)return;s=r?.find(u=>u.GAA_DTA_AGENDA===$(t)),s!==void 0&&s.GAA_DTA_AGENDA===$(0)&&(a=await b(),n===void 0&&s!==void 0&&a===void 0?a=s:(a=await b(),a!==void 0&&(s=a)))}return a}catch(a){return L(a,!1)}}async function zt(t,e,r){try{const a=T.FLOWS.FULL+"/"+t+"/"+e,n={codigoFluxo:r,somenteAtivos:!0},s=await w.post(a,n),{sucess:u,data:i}=s.data;if(u&&M(i)){const o=i[0];for(const c of o.PESQUISAS)c.GFP_POSICAO=parseInt(c.GFP_POSICAO);return o.PESQUISAS=o.PESQUISAS.sort((c,p)=>c.GFP_POSICAO<p.GFP_POSICAO?-1:0),o}}catch(a){return L(a,!1)}}async function Le(t,e,r){try{const a=rt(new Date,"dd/MM/yyyy"),n=await Ce(t,e,a);if(!n||!Array.isArray(n))return!1;const s=n[n.length-1];return s?await Ue(s,r,t,e):!1}catch(a){return L(a,!1)}}async function Ce(t,e,r){try{const a=r||rt(new Date,"dd/MM/yyyy"),n=await w.get(`${T.TRADE.SYNC.DB}/${t}/${e}`,{params:{data:a}}),{sucess:s,data:u}=n.data;return s&&M(u)?u:null}catch(a){return L(a,null)}}async function Ue(t,e,r,a){try{const n=await Ge(t._ID,r,a),s=e||[];if(n){const u=n.find(i=>i._ID===t._ID);if(u.DB&&u.DB!=="Dados indisponíveis"){const i=se(u.DB),o=JSON.parse(i);if((await Fe(r,a,o.GAA_ID))?.GAA_FLG_STATUS===2)return o.status=2,await oe(o),e?s.unshift(o):s.push(o),{scheduleData:o,scheduleSelected:o,allScheduleData:s}}}return!1}catch(n){return L(n,!1)}}async function Ge(t,e,r){try{const a=await w.get(`${T.TRADE.SYNC.DB}/${e}/${r}/${t}`),{sucess:n,data:s}=a.data;return n&&s&&s.length>0?s:null}catch(a){return L(a,null)}}async function Fe(t,e,r){try{const a=await w.post(`${T.SCHEDULE.DATA}/${t}/${e}`,{gaaId:r}),{sucess:n,data:s}=a.data;return n&&s?s:null}catch(a){return L(a,null)}}const Me=async()=>{const t=await b();if(t!==void 0&&!t.sincronizado&&t.GAA_DTA_AGENDA!==$(0))return t};async function rr(t,e,r,a,n){try{const s=R();if(!s)return I("Sessão expirada"),!1;const u=s.empresaId,i=s.codigoUsuario,o=T.TRADE.START_DAY+"/"+u+"/"+i,l={file:Tt(JSON.stringify({scheduleData:t,dataHoraUsuario:n,gaaId:e,status:2,latitude:r,longitude:a}))},d=await w.post(o,l),{data:S,sucess:P}=d.data;if(P){I("Dia iniciado com sucesso",1);const v=String(S),g=v!=="undefined"?Yt(v):"";return M(g)?JSON.parse(g):null}}catch(s){return I("Erro ao iniciar o dia",3),L(s,!1)}}function Tt(t){return Dt.compressToBase64(t)}function Yt(t){try{const e=Dt.decompressFromBase64(t);return JSON.parse(e),e}catch{return Dt.decompress(t)}}async function ar(t){try{const e=R();if(!e)return I("Sessão expirada"),!1;const r=e.empresaId,a=e.codigoUsuario,n=await Kt(t,r,a,!1);I("Pesquisas sincronizadas com sucesso!",1);const{scheduleData:s,error:u}=n;if(s.sincronizando=!1,u===void 0)return await et(s),!0}catch(e){return L(e,!1)}}async function nr(t,e,r,a,n,s){try{const u=R();if(u){const i=u.empresaId,o=u.codigoUsuario,{success:c}=await Zt(s,t);if(c){const p=T.TRADE.END_DAY+"/"+i+"/"+o,S={file:Tt(JSON.stringify({scheduleData:t,dataHoraUsuario:n,gaaId:e,status:3,latitude:r,longitude:a}))},P=await w.post(p,S),{sucess:v}=P.data;if(v)return s("Deletando agenda"),await dt("scheduleDataDB"),s("Deletando imagens"),await dt("imageDB"),I("Dia finalizado com sucesso",1),!0}else return I("Não foi possível sincronizar todas as imagens"),!1}}catch{I("Não foi possível enviar a finalização do dia para o servidor")}}async function sr(t,e,r,a=!1){try{const n=R();if(!n)return I("Sessão expirada"),!1;const s=n.empresaId,u=n.codigoUsuario,{data:i,success:o}=await Zt(r,t);if(o){r!==void 0&&r("Sincronizando as pesquisas...");let c=i||t;a&&(c=await ze(c));const p=await Kt(c,s,u,e);if(p===void 0||p.scheduleData===void 0)return I("Não foi possível sincronizar"),!1;const{scheduleData:l,error:d}=p;if(d===void 0&&l)return l.sincronizando=!1,await et(l),I("Pesquisas sincronizadas com sucesso!",1),!0}else return I("Erro ao sincronizar as imagens"),!1}catch(n){return L(n,!1)}}async function Kt(t,e,r,a=!0){try{let n;const s={...t,sincrono:a},i={file:Tt(JSON.stringify(s))},o=T.TRADE.SYNC.BASE+"/"+e+"/"+r;let c;if(a){c=await w.post(o,i);const l=String(c?.data?.data),d=l!=="undefined"?Yt(l):"";n=M(d)?JSON.parse(d):null}else w.post(o,i),n=s;return{scheduleData:n,error:void 0}}catch(n){return I(`Não foi possível sincronizar ${n}`),{scheduleData:t,error:`Erro => ${n}`}}}async function ze(t){const{latitude:e,longitude:r}=await kt();return Te(t,function(n){for(const s of n.CLIENTES)if(s.SEQ_PADRAO===n.cliAtendimento){for(const u of s.checkIn)if(u.status===1){u.status=0,u.stop=new Date,u.latitudeCheckOut=e,u.longitudeCheckOut=r;break}s.status=2,s.lastCheckout=new Date,n.emAtendimento=!1;break}})}async function Zt(t,e){try{const r=await $t();if(M(r)){const a=await $e(e,t);return a.upload?(await et(a.data),{data:a.data,success:!0}):{data:null,success:!0}}else return{data:null,success:!0}}catch{return I("Não foi possível sincronizar as imagens"),{data:null,success:!0}}}async function $e(t,e){let r=!1;const a=async s=>{const u=[];for(const i of s){let o={...i};const c=!i.URL,p=i.GPP_TIPO_CAMPO===7,l=i.RESPOSTA;if(p&&l&&c)if(i.RESPOSTA!=="nao-se-aplica-eca82f"){e(`Enviando a imagem ${i.RESPOSTA}...`);const d=await ke(i);d&&!d.error&&(o={...i,URL:d.urlPath,ENDERECO_FISICO:d.physicalPath},r=!0)}else{const d="https://imgweb.saibweb.com.br/entregas/imagens/37426786000100/nao-se-aplica-eca82f.png";o={...i,URL:d,ENDERECO_FISICO:d},r=!0}u.push(o)}return u},n=JSON.parse(JSON.stringify(t));for(const s of n.CLIENTES)if(s.pesquisas){for(const u of s.pesquisas)if(u.DETALHAMENTO)for(const i of u.DETALHAMENTO){if(i.PERGUNTAS&&Array.isArray(i.PERGUNTAS)){const o=await a(i.PERGUNTAS);i.PERGUNTAS=o}if(i.AGRUPAMENTO&&Array.isArray(i.AGRUPAMENTO)){for(const o of i.AGRUPAMENTO)if(o.ITEMS&&Array.isArray(o.ITEMS)){for(const c of o.ITEMS)if(c.PERGUNTAS&&Array.isArray(c.PERGUNTAS)){const p=await a(c.PERGUNTAS);c.PERGUNTAS=p}}}}}return{data:n,upload:r}}async function ke(t){try{const e=R();if(e){const r=e.empresaCnpj,a=e.codigoUsuario,n=await ae(t.RESPOSTA);if(M(n)){const s=T.TRADE.SYNC.IMAGE+"/"+r+"/"+a,u=await w.post(s,n||void 0,{timeout:30*1e3}),{data:i}=u.data,o=void 0;if(i)return await ne(n.uniqueid),{physicalPath:i.physicalPath,urlPath:i.urlPath,error:o}}else return{physicalPath:"",urlPath:"",error:""}}}catch(e){return I(`ERRO ao enviar a imagem ${e}`),{physicalPath:void 0,urlPath:void 0,error:e}}}async function or(t,e){try{const r=R();if(r){const a=r.empresaId,n=r.codigoUsuario,s="/v1/schedule/setstatus/"+a+"/"+n,u={gaaId:t,status:e};await w.post(s,u)}}catch(r){return L(r,!1)}}async function ir(){try{const t=R();if(t){const e=t.empresaId,r=t.codigoUsuario,a=await ee();let n={},s;if(s=await $t(),s=JSON.stringify(s),n.FOTOS=s||[],a){const c=await re(a,"errors");n.ERROS=c||null}let u=await b();u=btoa(unescape(encodeURIComponent(JSON.stringify(u)))),n=btoa(unescape(encodeURIComponent(JSON.stringify(n))));const i={GSTO_FILE:u},o={GSTO_FILE:n};await w.post(`v2/trade/file/${e}/${r}`,i),await w.post(`v2/trade/file/${e}/${r}`,o)}}catch(t){return L(t,!1)}}export{Je as C,We as a,sr as b,Ke as c,ar as d,nr as e,le as f,kt as g,Ye as h,Ze as i,or as j,Ve as k,Me as l,Xe as m,tr as n,ir as o,Te as p,rr as s,er as u};
