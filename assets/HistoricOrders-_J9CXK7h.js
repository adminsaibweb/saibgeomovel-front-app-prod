import{L as D,K as N,J as j,N as s,aa as O,a1 as S,O as f,U as c,ac as p,S as C}from"./index-YngUMXNg.js";import{C as A,b as y,c as L,a as h}from"./card-CqYw-V1t.js";import{F as g}from"./currency-CxFzcO-j.js";import{b,c as I}from"./order-DN46F7wb.js";import{p as R}from"./parseISO-NgKaLFXC.js";import{P}from"./pencil-B8YbJYHy.js";import{T as w}from"./trash-2-D1IaqoF9.js";import{f as v}from"./format-BBYAYFtJ.js";import"./apiEndpoints-aSQtSIWE.js";import"./handleApiError-B5XCkBcY.js";import"./startOfDay-Be0wd0F5.js";function J(){const[r,o]=D.useState([]),{showLoading:d,hideLoading:n}=N(),_=j();async function T(a,t){try{const e=await c();d();const l=await b(a);l&&l.length!==0?_("/Admin/OrderDirect/EditOrder",{state:{id:a}}):(r[t].ATD_FLAG_SITUACAO="B",e.ORDERS_DIRECT.INPROGRESS=r,await p(e),o(r),C("Não é possível editar esse pedido"))}catch{}finally{n()}}async function m(a){if(d(),(await Promise.all(r[a].ITEMS.map(async l=>l.PED_NR_PEDIDO?await I(l.PED_NR_PEDIDO):!0))).every(l=>l)&&await I(r[a].ATD_ID)){delete r[a];const i=r.filter(u=>u);o(i);const x=await c();x.ORDERS_DIRECT.INPROGRESS=i,await p(x)}n()}async function E(){try{d();const a=await c();let t=a.ORDERS_DIRECT;t&&(t=a.ORDERS_DIRECT.INPROGRESS),o(t)}catch{}finally{n()}}return D.useEffect(()=>{E()},[]),s.jsxs(s.Fragment,{children:[s.jsx(O,{title:"Histórico de pedidos",backPath:"/Admin",showBackButton:!0}),s.jsx("div",{className:"flex w-full flex-col gap-4 p-4 lg:pt-18",children:r?.length?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-lg font-bold text-gray-900",children:"Pedidos"}),r.map((a,t)=>s.jsxs(A,{className:"w-full shadow-md p-0 gap-0",children:[s.jsx(y,{className:S("px-3 py-2 flex items-center justify-start rounded-t-lg",a.ATD_FLAG_SITUACAO==="L"?"bg-green-600":"bg-blue-600"),children:s.jsxs(L,{className:"flex items-center justify-start text-lg font-bold text-white",children:[a.ATD_QTDE_TOTAL," ",a.ATD_QTDE_TOTAL===1?"produto":"produtos"," - Valor total: ",g(a.ATD_VALOR_TOTAL)]})}),s.jsxs(h,{className:"flex flex-col gap-2 p-2",children:[a.ITEMS.some(e=>e.CLI_ID===-1)&&s.jsxs("div",{className:"flex flex-col gap-1 border-b border-gray-100",children:[s.jsxs("p",{className:"font-bold text-gray-900",children:[a.ITEMS.find(e=>e.CLI_ID===-1)?.NOME_FANTASIA," ","-"," ",a.ITEMS.find(e=>e.CLI_ID===-1)?.RAZAO_SOCIAL]}),s.jsxs("p",{className:"font-medium text-gray-600",children:[a.ITEMS.find(e=>e.CLI_ID===-1)?.CIDADE," -"," ",a.ITEMS.find(e=>e.CLI_ID===-1)?.UF]})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("p",{className:"font-semibold underline text-gray-700",children:"Venda"}),s.jsxs("p",{className:"font-medium text-gray-600",children:["Criado: ",v(R(a.ATD_DATA),"dd/MM/yyyy")]})]}),a.ATD_FLAG_SITUACAO==="L"&&s.jsx("p",{className:"font-bold text-green-700",children:"Pedido já processado"}),a.ATD_FLAG_SITUACAO==="P"&&s.jsxs("p",{className:"font-bold text-gray-700",children:["ID do atendimento: ",a.ATD_ID]}),(a.ATD_FLAG_SITUACAO==="P"||!a.ATD_FLAG_SITUACAO)&&s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(f,{onClick:()=>T(a.ATD_ID,t),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[s.jsx(P,{size:18}),s.jsx("span",{children:"Editar"})]}),s.jsxs(f,{onClick:()=>m(t),variant:"destructive",className:"flex items-center gap-2",children:[s.jsx(w,{size:18}),s.jsx("span",{children:"Excluir"})]})]}),s.jsx("div",{className:"flex flex-col gap-2 mt-2",children:a.ITEMS.map(e=>s.jsxs(A,{className:"border border-gray-200 shadow-sm p-0 gap-0",children:[s.jsx("div",{className:"rounded-t-lg bg-primary p-2 text-white",children:s.jsxs("span",{className:"font-bold text-sm",children:[e.QTDE_PEDIDO||e.PED_QTDE," ",e.QTDE_PEDIDO===1||e.PED_QTDE===1?"produto":"produtos"," ","- Valor total:"," ",g(e.PED_VALOR)]})}),s.jsxs(h,{className:"p-2 text-sm flex flex-col gap-1",children:[s.jsx("p",{className:"font-bold text-gray-900",children:e?.PROD_DESCR}),s.jsxs("p",{className:"font-bold text-gray-700",children:[e?.NOME_FANTASIA||a.CLI_NOME_FANTASIA," -"," ",e?.RAZAO_SOCIAL||a.CLI_RAZAO_SOCIAL]}),s.jsxs("p",{className:"font-medium text-gray-600",children:[e?.CIDADE," - ",e?.UF]}),s.jsx("p",{className:"font-semibold underline text-gray-700",children:"Consignado"}),e.ATD_FLAG_SITUACAO==="L"&&s.jsxs("p",{className:"font-bold text-green-700",children:["ID do atendimento: ",e.ATD_ID]})]})]},e.PED_NR_PEDIDO))})]})]},a.ATD_ID))]}):s.jsx("div",{className:"flex w-full justify-center p-4",children:s.jsx("p",{className:"text-lg font-bold text-gray-500",children:"Não existem registros de pedidos"})})})]})}export{J as default};
