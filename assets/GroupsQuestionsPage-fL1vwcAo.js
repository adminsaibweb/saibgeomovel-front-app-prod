import{I as X,ag as Y,N as e,ah as $,J as ee,L as c,Z as U,aa as se,P as h,S as g,O as F,ai as ae,ad as x,U as te,ac as re}from"./index-CYXlB6di.js";import{C as ne,a as oe}from"./card-CyEq7GHL.js";import{a as q}from"./currency-CxFzcO-j.js";import{u as ie}from"./useLocalStorage-C6Tu5Tk7.js";import{L as ce}from"./label-DZv4CB4a.js";import{F as N}from"./FieldSearch-hpKTLvJO.js";import{P as le}from"./package-CPoqMIl5.js";import{C as de}from"./check-ihX-jt9T.js";import"./calendar-CbLc9Ubs.js";import"./format-BBYAYFtJ.js";import"./startOfDay-Be0wd0F5.js";import"./addDays-CyOWDzeI.js";import"./chevron-down-BrwHMvvE.js";import"./popover-BaGBQ11z.js";import"./index-DekvUVLv.js";import"./index-j1y6my5Y.js";import"./calendar-t7hk2tVO.js";import"./pt-BR-mIVN-mbg.js";import"./input-B9CoZ-jW.js";import"./hash-B5v7kzv9.js";import"./clock-IyxNcF_P.js";import"./chevron-up-Dt0Be6tL.js";import"./camera-4vcxwOoC.js";const ue=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],pe=X("folder",ue),Ge=Y.memo(function({item:i,index:R,isNotApplicable:l,onChange:_}){const r=o=>{_(o,R)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ce,{className:"text-base font-semibold text-zinc-700",children:[$(i.GPP_PERGUNTA),i.GPP_FLG_ORIGATORIA===1&&l!==1&&e.jsx("span",{className:"text-2xl font-bold text-red-500 ml-1",children:"*"})]}),i.GPP_TIPO_CAMPO===11||i.GPP_TIPO_CAMPO===13?e.jsx("div",{className:"flex w-full flex-col gap-2",children:e.jsx(N,{typeField:i.GPP_TIPO_CAMPO,data:i.CAMPOS[0],search:i,onChange:r})}):i.GPP_TIPO_CAMPO===8||i.GPP_TIPO_CAMPO===10?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.CAMPOS?.filter(o=>o.GAC_FLG_STATUS===1)?.map(o=>e.jsx(N,{typeField:i.GPP_TIPO_CAMPO,data:o,search:i,onChange:r},o.GAC_DESCRICAO))}):i.CAMPOS?.filter(o=>o.GAC_FLG_STATUS===1)?.map(o=>e.jsx("div",{className:"flex w-full flex-col gap-2",children:e.jsx(N,{typeField:i.GPP_TIPO_CAMPO,data:o,search:i,onChange:r})},o.GAC_DESCRICAO))]})});function Me(){const S=ee(),[i,R]=c.useState(null),[l,_]=c.useState(null),[r,o]=c.useState(null),[G,k]=c.useState(null),[A,z]=ie("currentSearch"),D=c.useRef(r),C=c.useRef(G),b=c.useRef(A),L=c.useRef(l);c.useEffect(()=>{D.current=r},[r]),c.useEffect(()=>{C.current=G},[G]),c.useEffect(()=>{b.current=A},[A]),c.useEffect(()=>{L.current=l},[l]),c.useEffect(()=>{window.scrollTo(0,0)},[]);const w=A?.cliente,j=async s=>{const t=C.current,a=b.current,n=L.current;if(!t||!a||!s||!n)return;const d=a.posSearch,u=a.todasPesquisas,O=a.cliente,{PERGUNTAS:Z}=s,{DETALHAMENTO:J}=u[d]??{},K=Z?.some(p=>!x(p.RESPOSTA)&&p.GPP_FLG_ORIGATORIA===1),f=t?.findIndex(p=>p.GGR_ID===n.GGR_ID),E=n?.ITEMS?.findIndex(p=>p.GGI_ID===s.GGI_ID);if(f===-1||E===-1)return;if(t[f].ITEMS[E]={...t[f].ITEMS[E],...s,RED:K},J[0]?.GAP_FLG_OBRIGATORIA_NAO_APLICA===0){const p=t[f]?.ITEMS?.some(P=>P.RED&&P.GGI_FLG_ORIGATORIA_NAO_APLICA===0);t[f].RED=p}let m=0,I=0;t.forEach(p=>{p.ITEMS.forEach(P=>{P.PERGUNTAS.forEach(W=>{m++,x(W.RESPOSTA)&&I++})})}),u[d].QTDE_PERGUNTAS_RESPONDIDAS=I,u[d].PERCENTUAL_CONCLUIDO=q(100*I/m,0)+"%",u[d].CONCLUIDO=100*I/m,u[d].DETALHAMENTO[0].AGRUPAMENTO=t;const T=await te(),M=T.CLIENTES?.findIndex(p=>p.SEQ_PADRAO===O?.SEQ_PADRAO);M!==-1&&(T.CLIENTES[M].pesquisas=u,await re(T),t&&a&&a.pesquisa&&a.pesquisa.DETALHAMENTO&&a.pesquisa.DETALHAMENTO.length>0&&(a.pesquisa.DETALHAMENTO[0].AGRUPAMENTO=t,a.pesquisa.QTDE_PERGUNTAS_RESPONDIDAS=I,a.pesquisa.PERCENTUAL_CONCLUIDO=q(100*I/m,0)+"%",a.pesquisa.CONCLUIDO=100*I/m,z(a)))};async function Q(){j(D.current)}const H=c.useCallback((s,t)=>{o(a=>{const n={...s},d={...a,PERGUNTAS:a.PERGUNTAS.map((u,O)=>O===t?n:u)};return j(d),d})},[]);async function V(){if(window.scrollTo({top:0,behavior:"smooth"}),r?.PERGUNTAS?.some(n=>n.GPP_FLG_ORIGATORIA===1&&r.GGI_FLG_ORIGATORIA_NAO_APLICA===0&&!x(n.RESPOSTA))){g("Por favor, responda todas as perguntas obrigatórias antes de avançar.");return}await Q();const t=G?.findIndex(n=>n.GGR_ID===l.GGR_ID),a=l?.ITEMS?.findIndex(n=>n.GGI_ID===r.GGI_ID);if(!(t===-1||a===-1))if(a<l.ITEMS.length-1){const n=l.ITEMS[a+1];o(n)}else if(t<G.length-1){const n=G[t+1];_(n),n.ITEMS&&n.ITEMS.length>0?o(n.ITEMS[0]):o(null)}else g("Você chegou ao final da pesquisa",3)}function y(s){let t=!1,a=!1;if(s&&s.length>0){for(const n of s){t=!1;for(const d of n.ITEMS)a=d.PERGUNTAS.find(u=>u.GPP_FLG_ORIGATORIA!==0&&u.GPP_FLG_ORIGATORIA!==-1&&!x(u.RESPOSTA)&&d.GGI_FLG_ORIGATORIA_NAO_APLICA===0)!==void 0,d.RED=a,a&&!t&&(t=!0);n.RED=t}k(s)}}async function B(s){if(r){if(s.GGI_ID===r.GGI_ID)return!0;for(const a of r.PERGUNTAS)a.RED=a.GPP_FLG_ORIGATORIA!==0&&a.GPP_FLG_ORIGATORIA!==-1&&r.GGI_FLG_ORIGATORIA_NAO_APLICA===0&&!x(a.RESPOSTA);return!(r.PERGUNTAS.find(a=>a.RED)!==void 0)}else return!0}const v=c.useRef(!1);return c.useEffect(()=>{(async function(){try{if(v.current)return;if(A){v.current=!0;const t=A.pesquisa;R(t.GAP_DESCRICAO);const a=t?.GFP_ID;t!==""?U(t)&&y(t?.DETALHAMENTO[0]?.AGRUPAMENTO):U(w?.pesquisas)&&y(w?.pesquisas.find(n=>n.GFP_ID===a)?.DETALHAMENTO[0]?.AGRUPAMENTO||[])}}finally{}})()},[]),e.jsxs("div",{className:"min-h-full background-pages pb-18",children:[e.jsx(se,{title:i||"Pesquisa",showBackButton:!0,backPath:"/pesquisas-service"}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-primary/40 sticky top-14 lg:top-0 z-10 pb-1 lg:pt-16",children:e.jsx("div",{className:"container pb-1 mx-auto pt-4 overflow-x-auto snap-x snap-mandatory scroll-smooth scroll-px-4",children:e.jsx("div",{className:"flex gap-3 min-w-max px-3 pb-1",children:G?.map(s=>{const t=l?.GGR_ID===s.GGR_ID;return e.jsxs("button",{onClick:()=>{_(s),o(null)},className:h("flex relative items-center gap-2 px-6 py-3 rounded-full text-sm font-medium transition-all duration-200 snap-center",t?"bg-primary text-white shadow-md shadow-primary/20 scale-[1.02]":"bg-white text-zinc-600 border border-zinc-200 hover:bg-zinc-50"),children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:s.GGR_DESCRICAO}),s.RED&&e.jsx("span",{className:"absolute -top-2 -right-1 text-xs py-0.5 px-1 rounded-full bg-red-600 text-white",children:"Obrigatório"})]},s.GGR_ID)})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-4 space-y-4 w-full",children:[l&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-base font-semibold text-zinc-950 mb-3 uppercase tracking-wider",children:"Selecione o Item"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l?.ITEMS?.map(s=>e.jsxs("button",{onClick:async()=>{if(await B(s)===!1){g("Você não respondeu todas as perguntas da pesquisa");return}o(s)},className:h("relative flex flex-col items-center p-3 rounded-xl border-2 transition-all duration-200 bg-white",r?.GGI_ID===s.GGI_ID?"border-primary ring-2 ring-primary/10 shadow-lg scale-[1.02]":"border-transparent shadow-sm"),children:[s.RED&&s.GGI_FLG_ORIGATORIA_NAO_APLICA===0&&e.jsx("span",{className:"absolute -top-2 -right-1 text-xs py-0.5 px-1 rounded-full bg-red-600 text-white",children:"Obrigatório"}),e.jsx("div",{className:h("w-12 h-12 relative  mb-2 rounded-full flex items-center justify-center transition-colors",r?.GGI_ID===s.GGI_ID?"bg-primary/10":"bg-zinc-100"),children:e.jsx(le,{className:h("h-6 w-6",r?.GGI_ID===s.GGI_ID?"text-primary":"text-zinc-400")})}),e.jsx("span",{className:h("text-xs font-medium text-center line-clamp-2",r?.GGI_ID===s.GGI_ID?"text-primary":"text-zinc-600"),children:s.GGI_DESCRICAO}),r?.GGI_ID===s.GGI_ID&&e.jsx("div",{className:"absolute -top-2 -left-2 bg-primary text-white rounded-full p-0.5 shadow-sm",children:e.jsx(de,{className:"h-3 w-3"})})]},s.GGI_ID))})]}),r&&e.jsx("section",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:e.jsxs(ne,{className:"border-none shadow-lg overflow-hidden pt-0 gap-1",children:[e.jsx("div",{className:"h-3 bg-primary w-full"}),e.jsxs(oe,{className:"px-4 py-6 space-y-8",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-zinc-200 bg-primary/5 rounded-lg py-2 px-4",children:e.jsx("h3",{className:"font-bold text-lg text-zinc-800",children:r?.GGI_DESCRICAO})}),r?.PERGUNTAS?.filter(s=>s.GPP_FLG_STATUS===1)?.map((s,t)=>e.jsx(Ge,{item:s,index:t,isNotApplicable:r.GGI_FLG_ORIGATORIA_NAO_APLICA,onChange:H},s.GPP_ID))]})]})})]})]}),e.jsxs("div",{className:"fixed bottom-0 w-full left-0 right-0 p-4 bg-white border-t border-zinc-100 flex justify-between items-center z-20",children:[e.jsxs(F,{variant:"outline",onClick:()=>S(-1),className:"border-zinc-200 text-zinc-950 bg-transparent lg:ml-20",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsx(F,{disabled:!r,onClick:V,className:"bg-linear-to-r from-primary to-primary hover:from-primary/90 hover:to-primary/90 text-white px-8 shadow-lg shadow-primary/25",children:"Próximo Item"})]})]})}export{Me as default};
