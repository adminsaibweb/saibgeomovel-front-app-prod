import{I as $,L as i,N as e,O as w,P as U,X as ue,a7 as X,a1 as Ue,K as Ve,ap as $e,J as Be,aa as Ke,a2 as qe,V as le,S as T,U as de}from"./index-DyoTrttr.js";import{u as Ze}from"./index.esm-C9r6uydG.js";import{A as He,a as Je,b as Ye,c as Xe}from"./accordion-BN0hfBJP.js";import{D as We,a as es,b as ss,c as ts}from"./dialog-DJtUg4ZH.js";import{F as as,a as os,b as rs,c as ns,d as is}from"./form-9mnPmkj3.js";import{I as cs}from"./input-UCdoJ7gY.js";import{L as z}from"./label-CxnlyZpL.js";import{B as ls}from"./badge-l8NN1nAK.js";import{C as ds,a as us,b as fs,d as ms,e as ps,f as xs,E as hs}from"./command-C6kcahgN.js";import{P as gs,a as Is,b as Ns}from"./popover-CM43x2Ig.js";import{C as Es}from"./check-BloVBNVn.js";import{c as re,a as Ds,P as q,b as G,u as fe,e as vs}from"./index-EUJ98zd7.js";import{c as bs,u as me}from"./index-C67vvhsx.js";import{u as js,e as ys}from"./index-F2Tpailh.js";import{u as Os,M as _s}from"./index-qreMmLpa.js";import{R as Cs,C as Rs,a as Ss,T as As,P as ws,O as Ps}from"./index-Y5F-0usq.js";import{b as Ts}from"./timesAndDates-1cQtfPVw.js";import{P as Fs}from"./package-CHO7grJ-.js";import{C as ks}from"./calendar-S-JGCjKB.js";import{a as Ls,h as Ms}from"./order-Cfswk0WD.js";import{S as Gs}from"./send-b_1PF3ud.js";import{S as Qs}from"./search-CSK8g4Am.js";import"./chevron-down-DHv8nuNw.js";import"./format-BBYAYFtJ.js";import"./startOfDay-Be0wd0F5.js";import"./addDays-CyOWDzeI.js";import"./pt-BR-mIVN-mbg.js";import"./apiEndpoints-aSQtSIWE.js";import"./handleApiError-kT6tIuMW.js";const zs=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Us=$("arrow-right-left",zs);const Vs=[["path",{d:"m16 22-1-4",key:"1ow2iv"}],["path",{d:"M19 13.99a1 1 0 0 0 1-1V12a2 2 0 0 0-2-2h-3a1 1 0 0 1-1-1V4a2 2 0 0 0-4 0v5a1 1 0 0 1-1 1H6a2 2 0 0 0-2 2v.99a1 1 0 0 0 1 1",key:"iw8jdu"}],["path",{d:"M5 14h14l1.973 6.767A1 1 0 0 1 20 22H4a1 1 0 0 1-.973-1.233z",key:"1soew8"}],["path",{d:"m8 22 1-4",key:"s3unb"}]],$s=$("brush-cleaning",Vs);const Bs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],Ks=$("circle-minus",Bs);const qs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Zs=$("circle-plus",qs);const Hs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Js=$("circle",Hs);const Ys=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Xs=$("funnel",Ys);const Ws=[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]],et=$("package-check",Ws);function Y({options:s,selected:o,onChange:r,placeholder:c="Select items...",className:f}){const[g,h]=i.useState(!1),j=l=>{r(o.filter(d=>d!==l))};return e.jsxs(gs,{open:g,onOpenChange:h,children:[e.jsx(Is,{asChild:!0,children:e.jsxs(w,{variant:"outline",role:"combobox","aria-expanded":g,className:U("w-full justify-between",f),onClick:()=>h(!g),children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[o.length===0&&c,o.map(l=>e.jsxs(ls,{variant:"secondary",className:"mr-1 mb-1",onClick:d=>{d.stopPropagation(),j(l)},children:[s.find(d=>d.value===l)?.label||l,e.jsx("button",{className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onKeyDown:d=>{d.key==="Enter"&&j(l)},onMouseDown:d=>{d.preventDefault(),d.stopPropagation()},onClick:()=>j(l),children:e.jsx(ue,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},l))]}),e.jsx(ds,{className:"h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ns,{className:"w-full p-0",children:e.jsxs(us,{children:[e.jsx(fs,{placeholder:"Search..."}),e.jsx(ms,{children:"No item found."}),e.jsx(ps,{className:"max-h-64 overflow-auto",children:s.map(l=>e.jsxs(xs,{onSelect:()=>{r(o.includes(l.value)?o.filter(d=>d!==l.value):[...o,l.value]),h(!0)},children:[e.jsx(Es,{className:U("mr-2 h-4 w-4",o.includes(l.value)?"opacity-100":"opacity-0")}),l.label]},l.value))})]})})]})}var te="rovingFocusGroup.onEntryFocus",st={bubbles:!1,cancelable:!0},H="RovingFocusGroup",[oe,pe,tt]=bs(H),[at,xe]=re(H,[tt]),[ot,rt]=at(H),he=i.forwardRef((s,o)=>e.jsx(oe.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(oe.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(nt,{...s,ref:o})})}));he.displayName=H;var nt=i.forwardRef((s,o)=>{const{__scopeRovingFocusGroup:r,orientation:c,loop:f=!1,dir:g,currentTabStopId:h,defaultCurrentTabStopId:j,onCurrentTabStopIdChange:l,onEntryFocus:d,preventScrollOnEntryFocus:I=!1,..._}=s,C=i.useRef(null),y=X(o,C),v=me(g),[A,x]=fe({prop:h,defaultProp:j??null,onChange:l,caller:H}),[F,V]=i.useState(!1),R=js(d),S=pe(r),B=i.useRef(!1),[J,K]=i.useState(0);return i.useEffect(()=>{const u=C.current;if(u)return u.addEventListener(te,R),()=>u.removeEventListener(te,R)},[R]),e.jsx(ot,{scope:r,orientation:c,dir:v,loop:f,currentTabStopId:A,onItemFocus:i.useCallback(u=>x(u),[x]),onItemShiftTab:i.useCallback(()=>V(!0),[]),onFocusableItemAdd:i.useCallback(()=>K(u=>u+1),[]),onFocusableItemRemove:i.useCallback(()=>K(u=>u-1),[]),children:e.jsx(q.div,{tabIndex:F||J===0?-1:0,"data-orientation":c,..._,ref:y,style:{outline:"none",...s.style},onMouseDown:G(s.onMouseDown,()=>{B.current=!0}),onFocus:G(s.onFocus,u=>{const Q=!B.current;if(u.target===u.currentTarget&&Q&&!F){const k=new CustomEvent(te,st);if(u.currentTarget.dispatchEvent(k),!k.defaultPrevented){const P=S().filter(M=>M.focusable),m=P.find(M=>M.active),L=P.find(M=>M.id===A),ee=[m,L,...P].filter(Boolean).map(M=>M.ref.current);Ne(ee,I)}}B.current=!1}),onBlur:G(s.onBlur,()=>V(!1))})})}),ge="RovingFocusGroupItem",Ie=i.forwardRef((s,o)=>{const{__scopeRovingFocusGroup:r,focusable:c=!0,active:f=!1,tabStopId:g,children:h,...j}=s,l=Ds(),d=g||l,I=rt(ge,r),_=I.currentTabStopId===d,C=pe(r),{onFocusableItemAdd:y,onFocusableItemRemove:v,currentTabStopId:A}=I;return i.useEffect(()=>{if(c)return y(),()=>v()},[c,y,v]),e.jsx(oe.ItemSlot,{scope:r,id:d,focusable:c,active:f,children:e.jsx(q.span,{tabIndex:_?0:-1,"data-orientation":I.orientation,...j,ref:o,onMouseDown:G(s.onMouseDown,x=>{c?I.onItemFocus(d):x.preventDefault()}),onFocus:G(s.onFocus,()=>I.onItemFocus(d)),onKeyDown:G(s.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){I.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const F=lt(x,I.orientation,I.dir);if(F!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let R=C().filter(S=>S.focusable).map(S=>S.ref.current);if(F==="last")R.reverse();else if(F==="prev"||F==="next"){F==="prev"&&R.reverse();const S=R.indexOf(x.currentTarget);R=I.loop?dt(R,S+1):R.slice(S+1)}setTimeout(()=>Ne(R))}}),children:typeof h=="function"?h({isCurrentTabStop:_,hasTabStop:A!=null}):h})})});Ie.displayName=ge;var it={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ct(s,o){return o!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function lt(s,o,r){const c=ct(s.key,r);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return it[c]}function Ne(s,o=!1){const r=document.activeElement;for(const c of s)if(c===r||(c.focus({preventScroll:o}),document.activeElement!==r))return}function dt(s,o){return s.map((r,c)=>s[(o+c)%s.length])}var ut=he,ft=Ie,ne="Radio",[mt,Ee]=re(ne),[pt,xt]=mt(ne),De=i.forwardRef((s,o)=>{const{__scopeRadio:r,name:c,checked:f=!1,required:g,disabled:h,value:j="on",onCheck:l,form:d,...I}=s,[_,C]=i.useState(null),y=X(o,x=>C(x)),v=i.useRef(!1),A=_?d||!!_.closest("form"):!0;return e.jsxs(pt,{scope:r,checked:f,disabled:h,children:[e.jsx(q.button,{type:"button",role:"radio","aria-checked":f,"data-state":ye(f),"data-disabled":h?"":void 0,disabled:h,value:j,...I,ref:y,onClick:G(s.onClick,x=>{f||l?.(),A&&(v.current=x.isPropagationStopped(),v.current||x.stopPropagation())})}),A&&e.jsx(je,{control:_,bubbles:!v.current,name:c,value:j,checked:f,required:g,disabled:h,form:d,style:{transform:"translateX(-100%)"}})]})});De.displayName=ne;var ve="RadioIndicator",be=i.forwardRef((s,o)=>{const{__scopeRadio:r,forceMount:c,...f}=s,g=xt(ve,r);return e.jsx(vs,{present:c||g.checked,children:e.jsx(q.span,{"data-state":ye(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:o})})});be.displayName=ve;var ht="RadioBubbleInput",je=i.forwardRef(({__scopeRadio:s,control:o,checked:r,bubbles:c=!0,...f},g)=>{const h=i.useRef(null),j=X(h,g),l=Os(r),d=ys(o);return i.useEffect(()=>{const I=h.current;if(!I)return;const _=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(_,"checked").set;if(l!==r&&y){const v=new Event("click",{bubbles:c});y.call(I,r),I.dispatchEvent(v)}},[l,r,c]),e.jsx(q.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...f,tabIndex:-1,ref:j,style:{...f.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});je.displayName=ht;function ye(s){return s?"checked":"unchecked"}var gt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],W="RadioGroup",[It]=re(W,[xe,Ee]),Oe=xe(),_e=Ee(),[Nt,Et]=It(W),Ce=i.forwardRef((s,o)=>{const{__scopeRadioGroup:r,name:c,defaultValue:f,value:g,required:h=!1,disabled:j=!1,orientation:l,dir:d,loop:I=!0,onValueChange:_,...C}=s,y=Oe(r),v=me(d),[A,x]=fe({prop:g,defaultProp:f??null,onChange:_,caller:W});return e.jsx(Nt,{scope:r,name:c,required:h,disabled:j,value:A,onValueChange:x,children:e.jsx(ut,{asChild:!0,...y,orientation:l,dir:v,loop:I,children:e.jsx(q.div,{role:"radiogroup","aria-required":h,"aria-orientation":l,"data-disabled":j?"":void 0,dir:v,...C,ref:o})})})});Ce.displayName=W;var Re="RadioGroupItem",Se=i.forwardRef((s,o)=>{const{__scopeRadioGroup:r,disabled:c,...f}=s,g=Et(Re,r),h=g.disabled||c,j=Oe(r),l=_e(r),d=i.useRef(null),I=X(o,d),_=g.value===f.value,C=i.useRef(!1);return i.useEffect(()=>{const y=A=>{gt.includes(A.key)&&(C.current=!0)},v=()=>C.current=!1;return document.addEventListener("keydown",y),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",y),document.removeEventListener("keyup",v)}},[]),e.jsx(ft,{asChild:!0,...j,focusable:!h,active:_,children:e.jsx(De,{disabled:h,required:g.required,checked:_,...l,...f,name:g.name,ref:I,onCheck:()=>g.onValueChange(f.value),onKeyDown:G(y=>{y.key==="Enter"&&y.preventDefault()}),onFocus:G(f.onFocus,()=>{C.current&&d.current?.click()})})})});Se.displayName=Re;var Dt="RadioGroupIndicator",Ae=i.forwardRef((s,o)=>{const{__scopeRadioGroup:r,...c}=s,f=_e(r);return e.jsx(be,{...f,...c,ref:o})});Ae.displayName=Dt;var vt=Ce,bt=Se,jt=Ae;function yt({className:s,...o}){return e.jsx(vt,{"data-slot":"radio-group",className:U("grid gap-3",s),...o})}function ae({className:s,...o}){return e.jsx(bt,{"data-slot":"radio-group-item",className:U("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...o,children:e.jsx(jt,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Js,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Ot({...s}){return e.jsx(Cs,{"data-slot":"sheet",...s})}function _t({...s}){return e.jsx(ws,{"data-slot":"sheet-portal",...s})}function Ct({className:s,...o}){return e.jsx(Ps,{"data-slot":"sheet-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...o})}function Rt({className:s,children:o,side:r="right",...c}){return e.jsxs(_t,{children:[e.jsx(Ct,{}),e.jsxs(Rs,{"data-slot":"sheet-content",className:U("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",r==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",r==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",r==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",r==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",s),...c,children:[o,e.jsxs(Ss,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(ue,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function St({className:s,...o}){return e.jsx("div",{"data-slot":"sheet-header",className:U("flex flex-col gap-1.5 p-4",s),...o})}function At({className:s,...o}){return e.jsx(As,{"data-slot":"sheet-title",className:U("text-foreground font-semibold",s),...o})}const we=i.memo(({product:s,onAddToOrder:o})=>{const r=s.LOCALIZACAO==="CONSIGNADO";return e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-200",children:[e.jsx("div",{className:"bg-linear-to-r from-primary to-primary/85 px-4 py-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-lg leading-tight",children:s.PROD_DESCR||s.NOME_FANTASIA}),s.PROD_DESCR&&e.jsxs("p",{className:"text-white text-xs mt-0.5",children:[s.LOTE," / ",s.SERIE]}),!s.PROD_DESCR&&s.RAZAO_SOCIAL&&e.jsx("p",{className:"text-white text-xs mt-0.5",children:s.RAZAO_SOCIAL})]}),e.jsx("span",{className:Ue("px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap",r?"bg-red-50 text-red-700":"bg-green-50 text-green-700"),children:s?.LOCALIZACAO?.replaceAll("_"," ")})]})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-3 mb-3 border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-primary/20 rounded-lg p-2 flex items-center justify-center",children:e.jsx(Fs,{size:20,className:"text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Produto"}),e.jsx("p",{className:"text-base font-bold text-gray-900 wrap-break-word",children:s.PRODUTO||s.PROD_DESCR}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:s.CODIGO_INTEGRACAOO||s.PROD_CODIGO})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_s,{size:16,className:"text-primary shrink-0"}),e.jsxs("p",{className:"text-base font-medium text-gray-700",children:[s.ENDERECO," - ",s.CIDADE," - ",s.UF]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Armazém"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:s.ESIN_ARMAZEM||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Quantidade"}),e.jsx("p",{className:"text-base font-bold text-gray-900",children:s.QTDE-s.QTDE_UTILIZADA})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Lote"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:s.LOTE})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Série"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:s.SERIE})]})]}),s.CONTATO&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contato"}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:s.CONTATO})]}),e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg px-3 py-2 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{children:e.jsx(ks,{size:18,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary font-medium",children:"Validade"}),e.jsx("p",{className:"text-base font-semibold text-primary",children:Ts(s.DATA_VALIDADE,"dd/MM/yyyy")})]})]})}),e.jsxs(w,{onClick:o,className:"w-full bg-primary active:bg-primary/85 text-white font-semibold py-6 rounded-lg shadow-sm transition-all",children:[e.jsx(Zs,{size:20}),"Adicionar no pedido"]})]})]})});we.displayName="ProductCard";function ia(){const[s,o]=i.useState(!1),[r,c]=i.useState(0),[f,g]=i.useState({ufs:[],citys:[],companys:[],armazens:[]}),[h,j]=i.useState([]),[l,d]=i.useState([]),[I,_]=i.useState([]),[C,y]=i.useState([]),[v,A]=i.useState("-1"),x=Ze(),{handleSubmit:F}=x,{showLoading:V,hideLoading:R}=Ve(),S=$e(),B=Be(),[J,K]=i.useState(!S.state?.productsFilter),[u,Q]=i.useState(S.state?.productsFilter?JSON.parse(`${S.state.productsFilter}`):[]),[k,P]=i.useState(S.state?.productsFilter?JSON.parse(`${S.state.productsFilter}`):[]),[m,L]=i.useState(S.state?.order?JSON.parse(`${S.state.order}`):[]);function Z(t){c(t),K(!1),t===3&&Le()}function ee(t){return{0:"Venda direta (consignado)",1:"Venda direta (venda)",2:"Venda direta (bonificação)",3:"Venda consignado"}[t]}async function M({search:t}){V();const a=await Ls(t);if(a){Q(a),P(a);const N=[],E=[],p=[],O=[];a.forEach(n=>{N.some(b=>b.value===n.UF)||N.push({value:n.UF,label:n.UF}),E.some(b=>b.value===n.CIDADE)||E.push({value:n.CIDADE,label:n.CIDADE}),p.some(b=>b.value===n.NOME_FANTASIA)||p.push({value:n.NOME_FANTASIA,label:n.NOME_FANTASIA}),O.some(b=>b.value===n.ESIN_ARMAZEM)||O.push({value:n.ESIN_ARMAZEM,label:n.ESIN_ARMAZEM})}),g({armazens:O,citys:E,companys:p,ufs:N})}R()}function Pe(t,a){const N=le();if(N){const E=N.empresaId,p=m.findIndex(D=>D.PROD_ID===t.PROD_ID&&D.CODIGO===t.CODIGO&&D.SERIE===t.SERIE),O=u.findIndex(D=>D.CODIGO_INTEGRACAOO===t.CODIGO_INTEGRACAOO&&D.ESIN_EMP_ID===E);if(O===-1){T("O produto não está cadastrado na empresa atual");return}const n=u[O],b=()=>{const D=[...u];if(D[a].QTDE>0)D[a]={...D[a],QTDE:D[a].QTDE-1};else return T("Estoque insuficiente no produto de origem"),!1;return Q(D),!0},Ge=(D,se)=>{if(D.QTDE_PEDIDO+1<=D.QTDE_ORIGIN-D.QTDE_UTILIZADA){const ze={...D,QTDE_PEDIDO:D.QTDE_PEDIDO+1,QTDE:D.QTDE-1,PROD_ID_VENDA:n?.PROD_ID||t.PROD_ID,ESIN_ID_VENDA:n?.ESIN_ID!==-1?n?.ESIN_ID:null,ESIN_EMP_ID_VENDA:n?.ESIN_EMP_ID||t.ESIN_EMP_ID},ce=[...m];ce[se]=ze,L(ce),T("Produto adicionado",1)}else T("Quantidade do pedido excede o estoque disponível")},Qe=()=>{const D={...t,QTDE_PEDIDO:1,QTDE_ORIGIN:t.QTDE,QTDE:t.QTDE-1,PROD_ID_VENDA:n?.PROD_ID||t.PROD_ID,ESIN_ID_VENDA:n?.ESIN_ID!==-1?n?.ESIN_ID:null,ESIN_EMP_ID_VENDA:n?.ESIN_EMP_ID||t.ESIN_EMP_ID},se=[...m,D];L(se),T("Produto adicionado",1)};b()&&(p!==-1?Ge(m[p],p):Qe())}}function Te(t){const a=u.findIndex(({PROD_ID:p,ESIN_ID:O,LOTE:n,SERIE:b})=>p===t.PROD_ID&&O===t.ESIN_ID&&n===t.LOTE&&b===t.SERIE);if(a===-1||u[a].QTDE<=0)return;const N=u[a];N.QTDE-=1;let E=m.find(({ESIN_ID:p})=>p===t.ESIN_ID);E?(E.QTDE_LIDO+=1,E.QTDE_ORDER=E.QTDE_LIDO):(E={...N,QTDE_LIDO:1,QTDE_ORDER:1},m.push(E),T("Produto adicionado ao pedido",1)),Q([...u]),L([...m])}function Fe(t){const a=m.findIndex(n=>n.PROD_ID===t.PROD_ID&&n.CODIGO===t.CODIGO&&n.SERIE===t.SERIE),N=u.findIndex(n=>n.PROD_ID===t.PROD_ID&&n.CODIGO===t.CODIGO&&n.SERIE===t.SERIE);if(a===-1){T("O produto não está no pedido atual");return}const E=m[a],p=()=>{if(N!==-1){const n=u[N],b=[...u];b[N]={...n,QTDE:n.QTDE+1},Q(b)}},O=()=>{const n=[...m];E.QTDE_PEDIDO>1?(n[a]={...E,QTDE_PEDIDO:E.QTDE_PEDIDO-1,QTDE:E.QTDE+1},L(n),T("Quantidade do pedido reduzida",1)):(n.splice(a,1),L(n),T("Produto removido do pedido",1))};p(),O()}function ke(t,a){const N=m[a];if(N?.QTDE_LIDO>0){const E=u.findIndex(({ESIN_ID:p})=>p===t.ESIN_ID);if(E!==-1){const p=u[E];p.QTDE+=1,p.QTDE_ORDER=Math.max(p.QTDE_ORDER-1,0)}N.QTDE_LIDO-=1,N.QTDE_LIDO===0&&m.splice(a,1),Q([...u]),L([...m])}}async function ie(t){V();const a=[],N=await de(),E=le();m.forEach(p=>{let O=N.CLI_IN_PROGRESS;if(!O&&(O=N?.CLIENTES?.find(b=>b.SEQ_PADRAO===N.cliAtendimento)?.CLI_ID,!O&&(O=N?.CLIENTES?.find(b=>b.CLI_ID===N.cliAtendimento)?.CLI_ID,!O))){T("Não foi possível encontrar o cliente atual"),R();return}const n=a.findIndex(b=>b.id===(p.CLI_ID||O));n!==-1?a[n]={name:p.NOME_FANTASIA,emp:p.ESIN_EMP_ID||E.empresaId,id:p.CLI_ID||O,products:[...a[n].products||[],p]}:a.push({name:p.NOME_FANTASIA,emp:p.ESIN_EMP_ID||E.empresaId,id:p.CLI_ID||O,products:[p]})}),B("/Admin/OrderDirect/NewOrder",{state:{companys:JSON.stringify(a),statusVenda:r,order:JSON.stringify(m),view:t,productsFilter:JSON.stringify(k),productsOrigins:JSON.stringify(u)}}),R()}async function Le(){try{V();const t=await de();let a=t.CONFERENCE;if(a&&(a=t.CONFERENCE.INVENTORY),(!a||a.length===0)&&(a=await Ms(t.CLI_IN_PROGRESS)),!a){T("Não foi possível buscar os dados, verifique sua conexão com a internet"),R(),B("/Admin");return}Q(a),P(a)}catch{}finally{R()}}function Me(){let t=u;l.length>0&&(t=t.filter(a=>l.includes(a.CIDADE))),h.length>0&&(t=t.filter(a=>h.includes(a.UF))),I.length>0&&(t=t.filter(a=>I.includes(a.NOME_FANTASIA))),C.length>0&&(t=t.filter(a=>C.includes(a.ESIN_ARMAZEM))),Number(v)===2?t=t.filter(a=>a.LOCALIZACAO==="EM_ESTOQUE"):Number(v)===1&&(t=t.filter(a=>a.LOCALIZACAO==="CONSIGNADO")),P(t),o(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{title:ee(r),backPath:"/Admin",showBackButton:!0}),e.jsxs("div",{className:"flex w-full  flex-col gap-4 p-4 lg:pt-18",children:[e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs(w,{onClick:()=>K(!0),className:"flex-1 gap-2 bg-white",variant:"outline",disabled:J||m&&m.length>0,children:[e.jsx(Us,{size:20}),"Alterar tipo"]}),u&&u.length>0&&e.jsxs(w,{onClick:()=>o(!0),className:"flex-1 gap-2",children:[e.jsx(Xs,{size:20}),"Filtrar"]}),e.jsxs(w,{onClick:()=>ie(!1),disabled:m&&m.length===0,className:"w-full flex-1 gap-2 bg-green-700 hover:bg-green-700/90 text-white",children:["Enviar pedido",e.jsx(Gs,{size:16})]})]}),e.jsx(as,{...x,children:e.jsxs("form",{className:"flex w-full flex-col gap-4",onSubmit:F(M),children:[e.jsx(os,{control:x.control,name:"search",rules:{required:"Campo obrigatório"},render:({field:t})=>e.jsxs(rs,{children:[e.jsx(ns,{children:"Buscar produto"}),e.jsx(is,{children:e.jsx(cs,{...t,placeholder:"Digite o nome ou código"})})]})}),e.jsxs(w,{type:"submit",className:"w-full gap-2",children:[e.jsx(Qs,{size:20}),"Pesquisar"]}),e.jsxs(w,{type:"button",variant:"secondary",onClick:async()=>{let t=!0;m&&m.length>0&&(t=await qe({title:"Limpar dados",message:"Deseja realmente limpar os dados? você pode perder os produtos já selecionados"})),t&&(x.reset(),L([]))},className:"-mt-2",children:["Limpar ",e.jsx($s,{size:16})]})]})}),m&&m.length>0&&e.jsxs("section",{className:"flex w-full flex-col gap-4",children:[e.jsx(He,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(Je,{value:"order-items",className:"border-b-0",children:[e.jsx(Ye,{className:"flex items-center gap-2 justify-between bg-primary/10 border border-primary p-6 hover:notuder",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center p-2 bg-primary rounded-full",children:e.jsx(et,{size:20,className:"text-white"})}),e.jsxs("span",{className:"text-primary font-bold text-lg hover:no-underline",children:[m.length===1&&`${m.length} produto no pedido`,m.length>1&&`${m.length} produtos no pedido`]})]})}),e.jsx(Xe,{className:"p-2 border border-t-0 rounded-b-md border-gray-200",children:m.map((t,a)=>e.jsxs("div",{className:"flex justify-between gap-2 border-b bg-primary/5 border-primary/60 p-2 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-bold text-zinc-900",children:t.PRODUTO||t.PROD_DESCR}),e.jsx("span",{className:"text-sm font-medium text-zinc-600",children:t.NOME_FANTASIA}),e.jsx("span",{className:"text-xs text-zinc-700",children:t.CLI_ID===-1?"Venda":"Devolução"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-base font-bold",children:["Qtde: ",t.QTDE_PEDIDO||t.QTDE_LIDO]}),e.jsx(w,{onClick:()=>{t.QTDE_LIDO?ke(t,a):Fe(t)},variant:"destructive",size:"icon",className:"h-8 w-8 rounded-full",children:e.jsx(Ks,{size:16})})]})]},t.ESIN_ID||`${t.PROD_ID}_${t.CODIGO}_${t.LOTE}_${a}`))})]})}),e.jsx("div",{className:"flex w-full flex-col items-center justify-between gap-2 -mt-2",children:e.jsxs("button",{onClick:()=>ie(!0),className:"flex w-full items-center justify-center gap-2 px-3 py-1.5 text-white bg-purple-900 rounded-md",children:["Visualizar ",e.jsx(hs,{size:16})]})})]}),e.jsx("div",{className:"flex w-full items-center justify-end",children:e.jsxs("span",{className:"text-sm font-semibold text-zinc-900",children:[k.length," produtos encontrados"]})}),e.jsx("div",{className:"flex flex-col gap-4",children:k.map((t,a)=>e.jsx(we,{product:t,onAddToOrder:()=>{t.PROD_DESCR?Te(t):Pe(t,a)}},`${t.PROD_ID}_${t.CODIGO}_${t.SERIE}`))}),(!k||k&&k.length===0)&&e.jsx("div",{className:"flex w-full items-center justify-center border-t border-gray-200 pt-4",children:e.jsx("span",{className:"text-center text-xl font-bold text-zinc-600",children:"Nenhum produto encontrado"})})]}),e.jsx(We,{open:J,onOpenChange:K,children:e.jsxs(es,{children:[e.jsx(ss,{children:e.jsx(ts,{children:"Escolha a opção de pedido"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(w,{onClick:()=>{P([]),Z(3)},className:"w-full",children:"Venda consignado"}),e.jsx(w,{onClick:()=>{P([]),Z(1)},className:"w-full",children:"Venda"}),e.jsx(w,{onClick:()=>{P([]),Z(0)},className:"w-full",children:"Consignado"}),e.jsx(w,{onClick:()=>{P([]),Z(2)},className:"w-full",children:"Bonificação"})]})]})}),e.jsx(Ot,{open:s,onOpenChange:o,children:e.jsxs(Rt,{side:"bottom",className:"h-[90vh] overflow-y-auto px-4",children:[e.jsx(St,{className:"py-2 px-0 text-lg",children:e.jsx(At,{children:"Filtrar produtos"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{children:"Tipo"}),e.jsxs(yt,{value:v,onValueChange:A,className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{value:"1",id:"r1"}),e.jsx(z,{className:"text-base",htmlFor:"r1",children:"Consignado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{value:"2",id:"r2"}),e.jsx(z,{className:"text-base",htmlFor:"r2",children:"Em estoque"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{value:"-1",id:"r3"}),e.jsx(z,{className:"text-base",htmlFor:"r3",children:"Todos"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{children:"Cidades"}),e.jsx(Y,{options:f.citys,selected:l,onChange:d,placeholder:"Selecione as cidades"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{children:"UF"}),e.jsx(Y,{options:f.ufs,selected:h,onChange:j,placeholder:"Selecione as UFs"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{children:"Empresa"}),e.jsx(Y,{options:f.companys,selected:I,onChange:_,placeholder:"Selecione as empresas"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{children:"Armazém"}),e.jsx(Y,{options:f.armazens,selected:C,onChange:y,placeholder:"Selecione os armazéns"})]}),e.jsx(w,{onClick:Me,className:"w-full mt-4",children:"Filtrar produtos"})]})]})})]})}export{ia as default};
